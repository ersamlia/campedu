{% extends 'main/base.html' %}
{% load static %}

{% block title %}Materi 1: Karakteristik Makhluk Hidup{% endblock %}

{% block custom_css %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');

body { font-family: 'Nunito', sans-serif; background: #f0f8ff; }

/* === HEADER === */
.modul-header-card {
    background: white; padding: 1.2rem; border-radius: 1rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 2rem;
    border-left: 6px solid #4e73df; display: flex; justify-content: space-between; align-items: center;
}
.step-badge {
    background: #eef2ff; color: #4e73df; padding: 8px 16px; border-radius: 30px;
    font-weight: 800; letter-spacing: 0.5px; border: 1px solid #d1d3e2;
}

/* === SLIDES === */
.learning-slide { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
.learning-slide.active { display: block; opacity: 1; }

.learning-card {
    background: white; border-radius: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    padding: 3rem; position: relative; overflow: hidden;
}

h3.title-highlight { color: #2e59d9; font-weight: 900; margin-bottom: 1rem; }
p.text-content { font-size: 1.1rem; color: #555; line-height: 1.8; }

/* === GAMBAR & SUMBER (STYLE BARU) === */
.img-container {
    position: relative; border-radius: 15px; overflow: hidden; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 10px;
    border: 1px solid #eee;
}
.img-content { width: 100%; height: 200px; object-fit: cover; }

/* Posisi Sumber: Pojok Kanan Atas (Konsisten) */
.img-source {
    position: absolute; 
    top: 8px;           /* Jarak dari atas */
    right: 8px;         /* Jarak dari kanan */
    background: rgba(0,0,0,0.6); /* Hitam transparan */
    color: #fff; 
    font-size: 0.65rem; 
    padding: 3px 10px; 
    border-radius: 20px; /* Membulat */
    font-style: italic; 
    z-index: 10; 
    font-family: sans-serif;
    backdrop-filter: blur(2px);
}

/* === SLIDE 1 (BATTLE MODE) === */
.question-box {
    background: #4e73df; color: white; padding: 15px 30px; border-radius: 50px;
    font-size: 1.1rem; font-weight: 700; text-align: center; margin-bottom: 30px;
    box-shadow: 0 5px 15px rgba(78, 115, 223, 0.3);
    max-width: 550px; margin-left: auto; margin-right: auto;
}
.battle-card {
    cursor: pointer; transition: transform 0.2s, border 0.2s; 
    border: 4px solid transparent; border-radius: 15px; background: #fff;
    padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    max-width: 280px; margin: 0 auto; 
}
.battle-card:hover { transform: scale(1.03); border-color: #d1d3e2; }
.battle-card.selected-correct { border-color: #1cc88a; background: #e8fbf3; }
.battle-card.selected-wrong { border-color: #e74a3b; animation: shake 0.5s; }
@keyframes shake {
  0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 
  50% { transform: translateX(5px); } 100% { transform: translateX(0); }
}

/* === SLIDE 3: CHECKLIST & CONCLUSION === */
.investigation-area {
    background: #f8f9fc; border-radius: 15px; padding: 20px; border: 2px solid #e3e6f0;
}
.ciri-item {
    background: white; padding: 15px; margin-bottom: 10px; border-radius: 10px;
    display: flex; justify-content: space-between; align-items: center;
    border: 1px solid #eee; transition: 0.2s;
}
.ciri-item:hover { transform: translateX(5px); border-color: #4e73df; }
.ciri-label { font-weight: 700; color: #555; }
.btn-check { border-radius: 20px; padding: 5px 15px; font-size: 0.85rem; }
.result-badge {
    display: none; font-weight: 800; padding: 5px 10px; border-radius: 5px; font-size: 0.85rem;
}
.res-yes { background: #d1e7dd; color: #0f5132; }
.res-no { background: #f8d7da; color: #842029; }
.conclusion-box {
    background: #fff; border: 2px dashed #4e73df; border-radius: 15px; 
    padding: 15px; margin-top: 15px; text-align: center;
    animation: fadeIn 0.5s; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
.btn-conclusion { 
    width: 100%; padding: 8px; font-weight: 700; border-radius: 10px; margin-bottom: 8px; font-size: 0.9rem;
}

/* === SLIDE 4: MATERI TABS (GAMBAR GANDA) === */
.nav-pills-custom .nav-link {
    border-radius: 50px; font-weight: 700; color: #858796; background: #fff;
    border: 1px solid #e3e6f0; margin-right: 8px; padding: 10px 20px; margin-bottom: 10px;
    text-align: left; transition: 0.3s;
}
.nav-pills-custom .nav-link.active {
    background: #4e73df; color: white; border-color: #4e73df; 
    box-shadow: 0 4px 10px rgba(78, 115, 223, 0.3);
}
.nav-pills-custom .nav-link.read-mark::after {
    content: '\f00c'; font-family: 'Font Awesome 5 Free'; font-weight: 900;
    float: right; color: #1cc88a;
}
.feature-content {
    background: #f8f9fc; border-radius: 15px; padding: 25px; border: 1px solid #e3e6f0;
    display: flex; flex-direction: column; gap: 15px;
}
.split-img-box {
    display: flex; gap: 10px; height: 180px; width: 100%;
}
.half-img {
    flex: 1; position: relative; border-radius: 10px; overflow: hidden;
    box-shadow: 0 4px 5px rgba(0,0,0,0.1);
}
.half-img img { width: 100%; height: 100%; object-fit: cover; }

/* LABEL GAMBAR SLIDE 4 */
.half-label {
    position: absolute; 
    bottom: 0; left: 0; width: 100%;
    /* Gradient Hitam Transparan agar tulisan terbaca */
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
    color: white; 
    font-size: 0.85rem;
    text-align: center; 
    padding: 20px 5px 8px 5px; /* Padding atas lebih besar untuk efek gradient */
    font-weight: 700;
    text-shadow: 0 1px 3px rgba(0,0,0,0.8);
    z-index: 5;
}

.feature-desc { font-size: 1.05rem; line-height: 1.7; color: #444; text-align: justify; border-top: 1px solid #ddd; padding-top: 15px; }
.lock-message { color: #e74a3b; font-size: 0.9rem; font-style: italic; margin-top: 10px; font-weight: bold; }

/* === SLIDE 5: TANTANGAN === */
.mission-box {
    background: #36b9cc; color: white; 
    padding: 10px 25px; border-radius: 50px; text-align: center;
    font-weight: 700; font-size: 1rem;
    margin: 0 auto 30px auto; 
    box-shadow: 0 5px 15px rgba(54, 185, 204, 0.3);
    max-width: 500px;
}
.target-card {
    background: white; border-radius: 15px; padding: 8px; border: 3px solid #eee;
    cursor: pointer; transition: 0.3s; position: relative; overflow: hidden;
    max-width: 220px; margin: 0 auto; 
}
.target-card:hover { transform: translateY(-5px); border-color: #36b9cc; }
.target-card img { width: 100%; height: 140px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
.target-card h6 { font-weight: 800; color: #555; margin: 0; font-size: 0.95rem; }
.target-card.wrong-pick { border-color: #e74a3b; background: #fdf2f2; animation: shake 0.5s; }
.target-card.correct-pick { border-color: #1cc88a; background: #eefdf6; }

.btn-start-game { font-size: 1rem; padding: 10px 30px; font-weight: 700; }

@media (max-width: 768px) {
    .img-content { height: 180px; }
    .split-img-box { height: 140px; }
    .target-card img { height: 120px; }
    .battle-card { max-width: 100%; } 
    .question-box { width: 100%; border-radius: 15px; }
}
</style>
{% endblock %}

{% block content %}

<div class="modul-header-card sticky-top" style="top: 15px; z-index: 99;">
    <div>
        <h5 class="font-weight-bold text-primary m-0"><i class="fas fa-seedling mr-2"></i>Materi 1: Karakteristik Makhluk Hidup</h5>
        
    </div>
    <div id="step-badge" class="step-badge">1. Stimulasi</div>
</div>

<div id="slide-1" class="learning-slide active">
    <div class="learning-card text-center">
        <h3 class="title-highlight">AyoTebak: Mobil vs Kucing</h3>
        <p class="text-content mb-4">
            Sebelum kita mulai, mari kita bandingkan dua objek ini. 
            <strong>Jawab pertanyaan di kotak biru</strong> dengan menekan gambar yang benar!
        </p>

        <div class="question-box shadow-sm" id="stimulus-question">
            Memuat Pertanyaan...
        </div>

        <div class="row justify-content-center">
            <div class="col-6 col-md-5 mb-3">
                <div class="battle-card" id="card-mobil" onclick="checkStimulus('mobil')">
                    <div class="img-container mb-0 border-0">
                        <img src="{% static 'img/mobil2.jpg' %}" class="img-content rounded" alt="Mobil">
                        <div class="img-source">Sumber: Dok. Pribadi</div>
                    </div>
                    <h5 class="font-weight-bold text-gray-800 mt-2">Mobil</h5>
                </div>
            </div>
            <div class="col-6 col-md-5 mb-3">
                <div class="battle-card" id="card-kucing" onclick="checkStimulus('kucing')">
                    <div class="img-container mb-0 border-0">
                        <img src="{% static 'img/kucing.jpg' %}" class="img-content rounded" alt="Kucing">
                        <div class="img-source">Sumber: Dok. Pribadi</div>
                    </div>
                    <h5 class="font-weight-bold text-gray-800 mt-2">Kucing</h5>
                </div>
            </div>
        </div>

        <div id="stimulus-feedback" class="mt-5" style="display: none;">
            <div class="alert alert-success d-inline-block px-4 py-2 mb-3">
                <i class="fas fa-check-circle"></i> <strong>Hebat!</strong> Pengamatanmu tajam.
            </div>
            <p id="stimulus-msg" class="text-muted font-italic mb-3"></p>
            <button class="btn btn-primary btn-lg rounded-pill px-5 shadow" onclick="nextSlide(2)">
                Mulai <i class="fas fa-search ml-2"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-2" class="learning-slide">
    <div class="learning-card">
        <h3 class="title-highlight">Pilih Objek Pengamatan</h3>
        <p class="text-content">
            Untuk menjawab pertanyaan tadi, kita akan melakukan <strong>Cek Fisik</strong> pada <strong>4 Objek</strong> ini.
        </p>
        
        <div class="row text-center mt-4">
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/pohon2.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">1. Pohon</h6>
            </div>
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/batu2.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">2. Batu</h6>
            </div>
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/kucing.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">3. Kucing</h6>
            </div>
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/mobil2.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">4. Mobil</h6>
            </div>
        </div>

        <div class="text-center mt-4">
            <p>Siap melakukan cek ciri-ciri kehidupan?</p>
            <button class="btn btn-primary rounded-pill px-4" onclick="nextSlide(3)">Lanjut ke Pengumpulan Data <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>
</div>

<div id="slide-3" class="learning-slide">
    <div class="learning-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="title-highlight m-0">Cek Ciri Kehidupan</h3>
            <span class="badge badge-primary p-2" id="object-counter">Objek 1 dari 4</span>
        </div>

        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="img-container">
                    <img id="current-img" src="" class="img-content">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h4 class="font-weight-bold text-gray-800 mt-2 text-center" id="current-name">...</h4>

                <div id="conclusion-area" class="conclusion-box" style="display: none;">
                    <h6 class="font-weight-bold text-primary mb-3">Apa Kesimpulanmu?</h6>
                    
                    <div id="selection-buttons">
                        <button class="btn btn-outline-success btn-conclusion" onclick="verifyConclusion(true)">
                            <i class="fas fa-leaf"></i> MAKHLUK HIDUP
                        </button>
                        <button class="btn btn-outline-secondary btn-conclusion" onclick="verifyConclusion(false)">
                            <i class="fas fa-cube"></i> BENDA MATI
                        </button>
                    </div>

                    <div id="feedback-area" class="mt-2" style="display:none;">
                        <div id="feedback-msg" class="alert font-weight-bold small p-2"></div>
                        <button id="next-object-btn" class="btn btn-primary btn-sm rounded-pill mt-2 btn-block" onclick="nextObject()">
                            Lanjut <i class="fas fa-chevron-right"></i>
                        </button>
                        <button id="finish-data-btn" class="btn btn-success btn-sm rounded-pill mt-2 btn-block" style="display:none;" onclick="nextSlide(4)">
                            Selesai <i class="fas fa-check-circle"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="investigation-area">
                    <p class="small text-muted mb-3">Klik tombol <strong>"Cek"</strong> untuk memeriksa apakah objek tersebut memiliki ciri berikut:</p>
                    <div id="checklist-box"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="slide-4" class="learning-slide">
    <div class="learning-card">
        <h3 class="title-highlight text-center">Ciri - ciri Makhluk Hidup</h3>
        <p class="text-content text-center mb-4">
            Klik pada <strong>setiap ciri (1-7)</strong> untuk membaca penjelasan lengkap dan mengaktifkan tombol lanjut.
        </p>

        <div class="row">
            <div class="col-md-4">
                <div class="nav flex-column nav-pills nav-pills-custom" role="tablist">
                    <a class="nav-link active" id="tab-1" data-toggle="pill" href="#ciri-1" onclick="markTabRead(1)">1. Bernapas</a>
                    <a class="nav-link" id="tab-2" data-toggle="pill" href="#ciri-2" onclick="markTabRead(2)">2. Memerlukan Nutrisi</a>
                    <a class="nav-link" id="tab-3" data-toggle="pill" href="#ciri-3" onclick="markTabRead(3)">3. Bergerak</a>
                    <a class="nav-link" id="tab-4" data-toggle="pill" href="#ciri-4" onclick="markTabRead(4)">4. Tumbuh & Berkembang</a>
                    <a class="nav-link" id="tab-5" data-toggle="pill" href="#ciri-5" onclick="markTabRead(5)">5. Reproduksi</a>
                    <a class="nav-link" id="tab-6" data-toggle="pill" href="#ciri-6" onclick="markTabRead(6)">6. Iritabilitas</a>
                    <a class="nav-link" id="tab-7" data-toggle="pill" href="#ciri-7" onclick="markTabRead(7)">7. Ekskresi</a>
                </div>
            </div>
            <div class="col-md-8">
                <div class="tab-content">
                    
                    <div class="tab-pane fade show active" id="ciri-1">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/manusiaBernafas.jpg' %}">
                                    <div class="img-source">Sumber: Tribunnewsmaker.com</div>
                                    <div class="half-label">Manusia</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuhanBernafas.jpg' %}">
                                    <div class="img-source">Sumber: thedailyECO</div>
                                    <div class="half-label">Tumbuhan</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Bernapas (Respirasi)</h5>
                                Bernapas adalah proses menghirup oksigen (O2) yang ada di lingkungan dan menghembuskan gas buangan berupa karbondioksida (CO2). Oksigen diperlukan tubuh untuk proses oksidasi (pembakaran) zat makanan guna menghasilkan energi.
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-2">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/hewanMakan.jpg' %}">
                                    <div class="img-source">Sumber: Kompas Regional</div>
                                    <div class="half-label">Hewan</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/pohonKasturi.jpg' %}">
                                    <div class="img-source">Sumber: Generasi Peneliti</div>
                                    <div class="half-label">Tumbuhan</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Memerlukan Makanan (Nutrisi)</h5>
                                Makanan berfungsi sebagai sumber energi, pengganti sel tubuh yang rusak, dan untuk pertumbuhan. Hewan bersifat <em>heterotrof</em> (memakan makhluk hidup lain), sedangkan tumbuhan bersifat <em>autotrof</em> (membuat makanan sendiri melalui fotosintesis).
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-3">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/kucingBergerak.jpeg' %}">
                                    <div class="img-source">Sumber: liputan6.com</div>
                                    <div class="half-label">Hewan (Gerak Aktif)</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuhanPasip.jpg' %}">
                                    <div class="img-source">Sumber: Dok. Kompas.com</div>
                                    <div class="half-label">Tumbuhan (Gerak Pasif)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Bergerak</h5>
                                Hewan dan manusia dapat melakukan gerak aktif (berpindah tempat) menggunakan alat gerak (kaki, sayap, sirip). Tumbuhan melakukan gerak pasif (tidak berpindah tempat), contohnya gerak ujung batang menuju cahaya matahari.
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-4">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuh.jpg' %}">
                                    <div class="img-source">Sumber: Blog StudyHouse</div>
                                    <div class="half-label">Manusia</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuhan.jpeg' %}">
                                    <div class="img-source">Sumber: Wayground</div>
                                    <div class="half-label">Tumbuhan</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Tumbuh dan Berkembang</h5>
                                <strong>Tumbuh</strong> adalah pertambahan ukuran tubuh yang tidak dapat kembali ke ukuran semula (contoh: tinggi badan bertambah). <strong>Berkembang</strong> adalah proses perubahan menuju kedewasaan (contoh: pematangan fungsi organ reproduksi).
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-5">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/kucingMenyusu.jpg' %}">
                                    <div class="img-source">Sumber: Dok. Pribadi</div>
                                    <div class="half-label">Hewan</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/bertunas.jpg' %}">
                                    <div class="img-source">Sumber: Djawanews.com</div>
                                    <div class="half-label">Tumbuhan (Bertunas)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Berkembang Biak (Reproduksi)</h5>
                                Kemampuan makhluk hidup untuk menghasilkan keturunan. Tujuannya adalah untuk melestarikan jenisnya agar tidak punah. Bisa secara generatif (kawin) maupun vegetatif (tidak kawin).
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-6">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/silau.webp' %}">
                                    <div class="img-source">Sumber: DepositPhotos</div>
                                    <div class="half-label">Manusia (Peka terhadap cahaya)</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/putri.jpg' %}">
                                    <div class="img-source">Sumber: bobo.ID</div>
                                    <div class="half-label">Tumbuhan (Sentuhan)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Peka Terhadap Rangsang (Iritabilitas)</h5>
                                Makhluk hidup mampu menanggapi rangsangan dari lingkungan. Rangsangan dapat berupa cahaya, bunyi, bau, rasa, atau sentuhan. Contoh: Daun putri malu menutup jika disentuh.
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-7">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/keringat.jpg' %}">
                                    <div class="img-source">Sumber: www.kumpulanilmu.com</div>
                                    <div class="half-label">Manusia (Keringat)</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/uap.jpg' %}">
                                    <div class="img-source">Sumber: Tribunnews.com</div>
                                    <div class="half-label">Tumbuhan (Uap Air)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Mengeluarkan Zat Sisa (Ekskresi)</h5>
                                Proses pengeluaran zat sisa metabolisme yang tidak dibutuhkan lagi oleh tubuh. Jika tidak dibuang, zat ini dapat menjadi racun. Contoh: Keringat, urin, dan uap air pernapasan.
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="text-right mt-4">
            <span id="lock-msg" class="lock-message">
                <i class="fas fa-lock"></i> Silakan baca semua ciri (1-7) untuk membuka tombol lanjut.
            </span>
            <button id="btn-next-slide-4" class="btn btn-primary btn-lg rounded-pill px-5" style="display: none;" onclick="nextSlide(5)">
                Selanjutnya <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-5" class="learning-slide">
    <div class="learning-card">
        <h3 class="title-highlight text-center">Uji Pemahaman: Analisis Klasifikasi</h3>
        
        <p class="text-content text-center mb-4">
            Perhatikan ketiga objek pada setiap ronde. Analisislah karakteristik dari setiap objek tersebut.
            <br>
            Tentukan <strong>satu objek</strong> yang memiliki klasifikasi berbeda (pengecualian) dibandingkan dua objek lainnya.
        </p>

        <div class="mission-box" id="mission-text">
            Siap? Klik tombol Mulai!
        </div>

        <div class="row justify-content-center" id="game-area" style="display: none;">
            <div class="col-4 col-md-3">
                <div class="target-card" id="option-0" onclick="checkOddOne(0)">
                    <img id="img-0" src="">
                    <div class="img-source" id="source-0">Sumber: -</div>
                    <h6 id="label-0">...</h6>
                </div>
            </div>
            <div class="col-4 col-md-3">
                <div class="target-card" id="option-1" onclick="checkOddOne(1)">
                    <img id="img-1" src="">
                    <div class="img-source" id="source-1">Sumber: -</div>
                    <h6 id="label-1">...</h6>
                </div>
            </div>
            <div class="col-4 col-md-3">
                <div class="target-card" id="option-2" onclick="checkOddOne(2)">
                    <img id="img-2" src="">
                    <div class="img-source" id="source-2">Sumber: -</div>
                    <h6 id="label-2">...</h6>
                </div>
            </div>
        </div>

        <div class="text-center mt-4" id="start-game-btn-area">
            <button class="btn btn-success rounded-pill shadow btn-start-game" onclick="startGameOddOne()">
                <i class="fas fa-play mr-2"></i> Mulai Analisis
            </button>
        </div>

        <div id="game-feedback" class="mt-4 text-center" style="display: none;">
            <h4 class="font-weight-bold" id="feedback-title"></h4>
            <p id="feedback-desc"></p>
            <button id="next-round-btn" class="btn btn-primary rounded-pill px-4" onclick="nextRound()">Lanjut Soal Berikutnya</button>
            <a id="finish-game-btn" href="{% url 'selesai_step' 'modul_1' %}" class="btn btn-success rounded-pill px-4 shadow" style="display: none;">
                Selesai<i class="fas fa-check-double"></i>
            </a>
        </div>

    </div>
</div>

{% endblock %}

{% block custom_js %}
<script>
// === 1. NAVIGATION GLOBAL ===
const stepNames = ["Stimulasi", "Identifikasi", "Pengumpulan Data", "Konsep", "Pembuktian"];

function nextSlide(n) {
    document.querySelectorAll('.learning-slide').forEach(el => {
        el.classList.remove('active');
        el.style.opacity = 0;
    });
    
    const target = document.getElementById('slide-' + n);
    target.classList.add('active');
    setTimeout(() => target.style.opacity = 1, 50);
    
    document.getElementById('step-badge').innerText = stepNames[n-1];
    document.querySelector('.modul-header-card').scrollIntoView({behavior: 'smooth'});

    if (n === 1) initStimulus();
    if (n === 3) loadInvestigation(0);
    if (n === 4) markTabRead(1); 
}

// === 2. LOGIC SLIDE 1 ===
const stimulusQuestions = [
    { text: "Mana yang memerlukan nutrisi untuk tumbuh?", answer: 'kucing' },
    { text: "Mana yang bergerak harus menggunakan bahan bakar?", answer: 'mobil' },
    { text: "Mana yang bernafas?", answer: 'kucing' }
];
let stimIndex = 0;

function initStimulus() {
    stimIndex = 0;
    showStimulusQuestion();
}

function showStimulusQuestion() {
    if(stimIndex < stimulusQuestions.length) {
        document.getElementById('stimulus-question').innerText = stimulusQuestions[stimIndex].text;
        ['mobil', 'kucing'].forEach(id => {
            const el = document.getElementById('card-' + id);
            el.classList.remove('selected-correct', 'selected-wrong');
            el.style.pointerEvents = 'auto';
        });
    } else {
        document.getElementById('stimulus-question').innerText = "Observasi Awal Selesai.";
        document.getElementById('stimulus-feedback').style.display = 'block';
        document.getElementById('stimulus-msg').innerText = "Kesimpulan awal: Mobil bergerak menggunakan energi mesin, sedangkan Kucing adalah sistem biologis yang kompleks.";
        ['mobil', 'kucing'].forEach(id => {
            document.getElementById('card-' + id).style.pointerEvents = 'none';
        });
    }
}

function checkStimulus(choice) {
    const correct = stimulusQuestions[stimIndex].answer;
    const card = document.getElementById('card-' + choice);
    
    if (choice === correct) {
        card.classList.add('selected-correct');
        setTimeout(() => {
            stimIndex++; 
            showStimulusQuestion();
        }, 800);
    } else {
        card.classList.add('selected-wrong');
        setTimeout(() => { card.classList.remove('selected-wrong'); }, 500);
    }
}

// === 3. LOGIC SLIDE 3 ===
const investigasiData = [
    { name: "Pohon", img: "{% static 'img/pohon2.jpg' %}", isLiving: true, traits: { 'Bernapas': true, 'Bergerak': true, 'Butuh Makan': true, 'Tumbuh': true, 'Berkembang Biak': true, 'Peka Rangsang': true, 'Ekskresi': true } },
    { name: "Batu", img: "{% static 'img/batu2.jpg' %}", isLiving: false, traits: { 'Bernapas': false, 'Bergerak': false, 'Butuh Makan': false, 'Tumbuh': false, 'Berkembang Biak': false, 'Peka Rangsang': false, 'Ekskresi': false } },
    { name: "Kucing", img: "{% static 'img/kucing.jpg' %}", isLiving: true, traits: { 'Bernapas': true, 'Bergerak': true, 'Butuh Makan': true, 'Tumbuh': true, 'Berkembang Biak': true, 'Peka Rangsang': true, 'Ekskresi': true } },
    { name: "Mobil", img: "{% static 'img/mobil2.jpg' %}", isLiving: false, traits: { 'Bernapas': false, 'Bergerak': true, 'Butuh Makan': false, 'Tumbuh': false, 'Berkembang Biak': false, 'Peka Rangsang': false, 'Ekskresi': false } }
];

let currentObjIdx = 0;
let checkedTraits = 0;

function loadInvestigation(idx) {
    const data = investigasiData[idx];
    document.getElementById('current-name').innerText = data.name;
    document.getElementById('current-img').src = data.img;
    document.getElementById('object-counter').innerText = `Objek ${idx + 1} dari ${investigasiData.length}`;
    
    document.getElementById('conclusion-area').style.display = 'none';
    document.getElementById('checklist-box').innerHTML = '';
    document.getElementById('feedback-area').style.display = 'none';
    document.getElementById('selection-buttons').style.display = 'block';
    checkedTraits = 0;

    for (const [trait, value] of Object.entries(data.traits)) {
        const safeId = trait.replace(/\s/g, '');
        const html = `
            <div class="ciri-item">
                <span class="ciri-label">${trait}?</span>
                <div>
                    <span id="res-${safeId}" class="result-badge"></span>
                    <button class="btn btn-outline-primary btn-check btn-sm" 
                        onclick="revealTrait(this, '${safeId}', ${value})">Cek</button>
                </div>
            </div>`;
        document.getElementById('checklist-box').insertAdjacentHTML('beforeend', html);
    }
}

function revealTrait(btn, safeId, isTrue) {
    const badge = document.getElementById(`res-${safeId}`);
    btn.style.display = 'none';
    badge.style.display = 'inline-block';
    if(isTrue) {
        badge.classList.add('res-yes');
        badge.innerHTML = '<i class="fas fa-check"></i> YA';
    } else {
        badge.classList.add('res-no');
        badge.innerHTML = '<i class="fas fa-times"></i> TIDAK';
    }
    checkedTraits++;
    if(checkedTraits === 7) {
        document.getElementById('conclusion-area').style.display = 'block';
    }
}

function verifyConclusion(studentSaysLiving) {
    const data = investigasiData[currentObjIdx];
    const isCorrect = (studentSaysLiving === data.isLiving);
    const feedbackMsg = document.getElementById('feedback-msg');

    document.getElementById('selection-buttons').style.display = 'none';
    document.getElementById('feedback-area').style.display = 'block';

    if (isCorrect) {
        feedbackMsg.className = "alert alert-success font-weight-bold small p-2";
        feedbackMsg.innerHTML = `<i class="fas fa-check-circle"></i> TEPAT! ${data.name} dikategorikan sebagai ${data.isLiving ? 'Makhluk Hidup' : 'Benda Mati'}.`;
    } else {
        feedbackMsg.className = "alert alert-danger font-weight-bold small p-2";
        feedbackMsg.innerHTML = `<i class="fas fa-times-circle"></i> KURANG TEPAT. Perhatikan kembali data ciri-cirinya.`;
    }

    if (currentObjIdx < investigasiData.length - 1) {
        document.getElementById('next-object-btn').style.display = 'block';
        document.getElementById('finish-data-btn').style.display = 'none';
    } else {
        document.getElementById('next-object-btn').style.display = 'none';
        document.getElementById('finish-data-btn').style.display = 'block';
    }
}

function nextObject() {
    currentObjIdx++;
    loadInvestigation(currentObjIdx);
}

// === 4. LOGIC SLIDE 4: TABS LOCK ===
let viewedTabs = new Set();
const totalTabs = 7;

function markTabRead(n) {
    viewedTabs.add(n);
    document.getElementById('tab-' + n).classList.add('read-mark');
    
    if (viewedTabs.size === totalTabs) {
        document.getElementById('lock-msg').style.display = 'none';
        document.getElementById('btn-next-slide-4').style.display = 'inline-block';
    }
}

// === 5. LOGIC SLIDE 5: ODD ONE OUT ===
const gameRounds = [
    {
        mission: "Identifikasi objek yang merupakan MAKHLUK HIDUP.",
        correctIdx: 1, 
        items: [
            { name: "Robot", img: "{% static 'img/robot.png' %}", source: "Dok. Canva" },
            { name: "Pohon", img: "{% static 'img/pohon2.jpg' %}", source: "Dok. Pribadi" }, 
            { name: "Air", img: "{% static 'img/air.jpg' %}", source: "Merdeka.com" }
        ]
    },
    {
        mission: "Identifikasi objek yang merupakan BENDA MATI.",
        correctIdx: 2,
        items: [
            { name: "Kucing", img: "{% static 'img/kucing.jpg' %}", source: "Dok. Pribadi" },
            { name: "Jamur", img: "{% static 'img/jamurroti.jpg' %}", source: "Dok. bobo ID" },
            { name: "Meja", img: "{% static 'img/meja.jpg' %}", source: "uwitan" } 
        ]
    },
    {
        mission: "Identifikasi satu-satunya MAKHLUK HIDUP di antara objek berikut.",
        correctIdx: 0,
        items: [
            { name: "Putri Malu", img: "{% static 'img/putri.jpg' %}", source: "bobo ID" }, 
            { name: "Api", img: "{% static 'img/api.jpg' %}", source: "Dok. Liputan6.com" }, 
            { name: "Mobil", img: "{% static 'img/mobil2.jpg' %}", source: "Dok. Pribadi" }
        ]
    }
];

let roundIdx = 0;

function startGameOddOne() {
    document.getElementById('start-game-btn-area').style.display = 'none';
    document.getElementById('game-area').style.display = 'flex';
    roundIdx = 0;
    loadRound();
}

function loadRound() {
    const data = gameRounds[roundIdx];
    document.getElementById('mission-text').innerHTML = `<i class="fas fa-search mr-2"></i> ${data.mission}`;
    document.getElementById('game-feedback').style.display = 'none';
    
    // Reset cards and set sources
    for(let i=0; i<3; i++) {
        const card = document.getElementById(`option-${i}`);
        card.classList.remove('correct-pick', 'wrong-pick');
        card.style.pointerEvents = 'auto'; 
        
        document.getElementById(`img-${i}`).src = data.items[i].img;
        document.getElementById(`label-${i}`).innerText = data.items[i].name;
        document.getElementById(`source-${i}`).innerText = "Sumber: " + data.items[i].source;
    }
}

function checkOddOne(pickIdx) {
    const data = gameRounds[roundIdx];
    const correctIdx = data.correctIdx;
    
    if (pickIdx === correctIdx) {
        document.getElementById(`option-${pickIdx}`).classList.add('correct-pick');
        showFeedback(true);
    } else {
        document.getElementById(`option-${pickIdx}`).classList.add('wrong-pick');
        setTimeout(() => {
             document.getElementById(`option-${pickIdx}`).classList.remove('wrong-pick');
        }, 500);
    }
}

function showFeedback(isSuccess) {
    if(!isSuccess) return;
    
    for(let i=0; i<3; i++) document.getElementById(`option-${i}`).style.pointerEvents = 'none';

    const fbTitle = document.getElementById('feedback-title');
    const fbDesc = document.getElementById('feedback-desc');
    const box = document.getElementById('game-feedback');
    const nextBtn = document.getElementById('next-round-btn');
    const finishBtn = document.getElementById('finish-game-btn');

    box.style.display = 'block';
    fbTitle.className = "text-success font-weight-bold";
    fbTitle.innerText = "Analisis Tepat!";
    fbDesc.innerText = "Anda berhasil mengidentifikasi objek dengan klasifikasi berbeda.";

    if (roundIdx < gameRounds.length - 1) {
        nextBtn.style.display = 'inline-block';
        finishBtn.style.display = 'none';
    } else {
        nextBtn.style.display = 'none';
        finishBtn.style.display = 'inline-block';
        fbDesc.innerText = "Selamat! Anda telah menyelesaikan seluruh rangkaian kegiatan Modul 1.";
    }
}

function nextRound() {
    roundIdx++;
    loadRound();
}

// Init
document.addEventListener('DOMContentLoaded', () => {
    initStimulus();
});
</script>
{% endblock %}