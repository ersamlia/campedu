{% extends 'main/base.html' %}
{% load static %}
{% block title %}Modul 1: {{ subbab.judul }}{% endblock %}

{% block custom_css %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap');
body {
    font-family: 'Nunito', sans-serif;
    background: #f3f6fd;
}

/* CARD JUDUL HEADER CONSISTENT */
.modul-header-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.6rem;
    background: #fff;
    padding: 1.1rem 1.5rem;
    border-radius: 1.2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.03);
}
.modul-header-title {
    font-family: 'Nunito', sans-serif;
    color: #22356f;
    font-weight: 900;
    font-size: 1.28rem;
    margin-bottom: 3px;
}
.modul-header-keterangan {
    font-size: 0.92rem;
    color: #7a849c;
    font-weight: 600;
    letter-spacing: 0.5px;
}
.learning-slide { display: none; }
.learning-slide.active {
    display: block !important;
    width: 100%;
}
.learning-card {
    background: #fff;
    border-radius: 2.2rem;
    box-shadow: 0 8px 32px rgba(53,99,233,0.10);
    padding: 2.6rem 5vw 2.2rem 5vw;
    width: 100%;
    max-width: 100%;
    margin: 0 auto 2.5rem auto;
    font-family: 'Nunito', sans-serif;
}
@media (max-width: 900px) {
    .learning-card { padding: 1.0rem .7rem 1.0rem .7rem; border-radius: 1.08rem;}
    .modul-header-card { padding: 0.7rem;}
    .modul-header-title { font-size: 1.12rem;}
}
.learning-card .card-header {
    background: transparent;
    border: none;
    border-radius: 2.2rem 2.2rem 0 0;
    font-weight: 800;
    padding: 0;
    margin-bottom: 1.02rem;
}
.learning-card .card-header h6 {
    color: #246bfd;
    font-size: 1.13rem;
    font-weight: 900;
    font-family: 'Nunito', sans-serif !important;
    margin-bottom: 0;
    line-height: 1.22;
    letter-spacing: .007em;
}
.learning-card .card-body h5, .learning-card .card-body h4 {
    font-family: 'Nunito', sans-serif !important;
    color: #1c253b;
    font-size: 1.19rem;
    font-weight: 800;
    margin-bottom: .58rem;
}
.learning-card ul, .learning-card ol {
    margin-left: 1.11rem;
    margin-bottom: 1rem;
    color: #495466;
}
.learning-card button.btn-primary {
    background-color: #246bfd;
    font-weight: 700;
    border-radius: 0.85rem;
    border: none;
}
.learning-card button.btn-primary:hover, .learning-card button.btn-primary:focus {
    background-color: #1c519b;
}
.learning-card button.btn-secondary { border-radius: 0.85rem; }
.learning-card .form-control {
    border-radius: 0.8rem;
    border: 1px solid #eaf0fb;
    font-size: 1.1rem;
    padding: 0.9rem 1.1rem;
    background: #f7fbff;
}
.learning-card .form-control:focus {
    border-color: #246bfd;
    background: #fff;
}
.learning-card hr {
    border-color: #eaf0fb;
    margin: 1.13rem 0;
}
a.btn.disabled {
    pointer-events: none; opacity: 0.65;
}
<<<<<<< Updated upstream

/* === CSS KHUSUS MODUL 1 === */
/* Style untuk gambar di Slide 3 dan 4 */
#obj-img {
    width: 100%;
    max-height: 250px;
    object-fit: contain;
    background: #ffffff;
    border-radius: 1.08rem;
    padding: 10px;
=======
.stim-img, #obj-img {
    height: 180px;
    width: 100%;
    object-fit: cover;
    border-radius: 1.08rem;
>>>>>>> Stashed changes
}
#checklist .btn {
    border-radius: 0.85rem;
    text-align: left;
    width: 100%;
    font-weight: 700;
    margin-bottom: 0.5rem;
}
#checklist .btn .fa-square { color: #4e73df; }
#checklist .btn .fa-check-square { color: #ffffff; }
#checklist .btn .fa-times-circle { color: #ffffff; }
</style>
{% endblock %}

{% block content %}
<div class="modul-header-card">
    <div>
        <div class="modul-header-title">Modul 1: {{ subbab.judul }}</div>
        <div class="modul-header-keterangan">
            {{ subbab.deskripsi|default:"Kerjakan modul berikut dengan jujur dan sungguh-sungguh." }}
        </div>
    </div>
</div>

<div id="slide-1" class="learning-slide active">
    <div class="learning-card">
        <div class="card-header">
            <h6>Tujuan Pembelajaran</h6>
        </div>
        <div class="card-body">
            <p>Setelah menyelesaikan modul ini, Anda diharapkan mampu:</p>
            <ul>
                <li>Membedakan benda hidup dan benda mati berdasarkan pengamatan.</li>
                <li>Mengidentifikasi ciri-ciri yang dimiliki oleh makhluk hidup.</li>
                <li>Menyimpulkan pengertian dari makhluk hidup berdasarkan ciri-cirinya.</li>
            </ul>
            <button class="btn btn-primary" onclick="showSlide(2)">Mulai Belajar <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>
</div>

<div id="slide-2" class="learning-slide">
    <div class="learning-card">
        <div class="card-header">
            <h6>Pemaparan Materi Singkat</h6>
        </div>
        <div class="card-body">
            <h5 class="text-gray-900">Apa itu Makhluk Hidup?</h5>
            <p>Di sekitar kita, terdapat banyak sekali benda. Ada benda yang dapat bergerak sendiri, bernapas, dan tumbuh besar, seperti kucing. Ada juga benda yang tidak bisa melakukan itu, seperti batu.</p>
            <p>Benda-benda yang memiliki kemampuan untuk bernapas, bergerak, makan, tumbuh, dan berkembang biak kita sebut sebagai <b>makhluk hidup</b>. Benda yang tidak memilikinya kita sebut <b>benda mati</b>.</p>
            <p>Sekarang, ayo kita temukan sendiri apa saja ciri-ciri pasti dari makhluk hidup melalui aktivitas berikut!</p>
            <button class="btn btn-secondary" onclick="showSlide(1)"><i class="fas fa-arrow-left"></i> Kembali</button>
            <button class="btn btn-primary" onclick="showSlide(3)">Lanjut ke Aktivitas <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>
</div>

<div id="slide-3" class="learning-slide">
    <div class="learning-card">
        <div class="card-header">
            <h6>Tahap 1: Materi Singkat</h6>
        </div>
        <div class="card-body">
            <p>Perhatikan 4 gambar di bawah ini. Menurutmu, mana yang makhluk hidup dan mana yang benda mati?</p>
            <div class="row text-center">
                <div class="col-md-3 mb-2">
                    <img src="{% static 'img/pohon.png' %}" class="img-fluid rounded mb-2 stim-img" alt="Pohon"><br>
                    <strong>Pohon</strong>
                </div>
                <div class="col-md-3 mb-2">
                    <img src="{% static 'img/batu.png' %}" class="img-fluid rounded mb-2 stim-img" alt="Batu"><br>
                    <strong>Batu</strong>
                </div>
                <div class="col-md-3 mb-2">
                    <img src="{% static 'img/burung.png' %}" class="img-fluid rounded mb-2 stim-img" alt="Burung"><br>
                    <strong>Burung</strong>
                </div>
                <div class="col-md-3 mb-2">
                    <img src="{% static 'img/mobil.png' %}" class="img-fluid rounded mb-2 stim-img" alt="Mobil"><br>
                    <strong>Mobil</strong>
                </div>
            </div>
            <hr>
            <h5 class="text-gray-900">Perumusan Masalah</h5>
            <p>Dari gambar di atas, kita bisa bertanya:</p>
            <ul>
                <li>"Apa perbedaan utama antara Burung dan Mobil? Keduanya sama-sama bisa bergerak."</li>
                <li>"Apa yang dimiliki Pohon tapi tidak dimiliki Batu?"</li>
            </ul>
            <p>Sekarang, ayo kita kumpulkan data untuk menjawabnya di tahap berikutnya!</p>
            <button class="btn btn-secondary" onclick="showSlide(2)"><i class="fas fa-arrow-left"></i> Kembali</button>
            <button class="btn btn-primary" onclick="showSlide(4)">Lanjut ke Eksplorasi <i class="fas fa-arrow-right"></i></button>
        </div>
    </div>
</div>

<div id="slide-4" class="learning-slide">
    <div class="learning-card">
        <div class="card-header">
            <h6>Tahap 2: Eksplorasi & Penemuan (Data Collection)</h6>
        </div>
        <div class="card-body" id="interactive-area">
            <p>Ayo kita kumpulkan data! Klik semua tombol ciri untuk menganalisis objek ini.</p>
            <div class="row">
                <div class="col-md-4">
                    <h4 id="obj-title" class="text-gray-900">Objek 1: Kucing</h4>
                    <img id="obj-img" src="{% static 'img/kucing.jpg' %}" alt="Kucing" class="img-fluid mb-3 rounded">
                    <button id="next-obj-btn" class="btn btn-info" style="display:none; border-radius: 0.85rem;" onclick="loadObject('Robot')">Analisis Objek Berikutnya <i class="fas fa-arrow-right"></i></button>
                </div>
                <div class="col-md-8">
                    <h4 class="text-gray-900">Checklist Ciri Kehidupan:</h4>
                    <div id="checklist" class="mb-3"></div>
                    <h5 id="obj-result" class="text-gray-900"></h5>
                </div>
            </div>
            <hr>
            <button class="btn btn-secondary" onclick="showSlide(3)"><i class="fas fa-arrow-left"></i> Kembali</button>
            <button id="finish-modul-btn" class="btn btn-primary" style="display:none" onclick="showSlide(5)">
                Lanjut ke Kesimpulan <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-5" class="learning-slide">
    <div class="learning-card">
        <div class="card-header">
            <h6>Tahap 3: Verifikasi & Kesimpulan</h6>
        </div>
        <div class="card-body">
            <h5 class="text-gray-900">Verifikasi</h5>
            <p>Dari aktivitas sebelumnya, Anda "menemukan" bahwa Kucing memiliki semua 7 ciri, sedangkan Robot hanya memiliki beberapa. Ini membuktikan bahwa sebuah benda baru disebut <b>makhluk hidup</b> jika memiliki <b>SEMUA</b> ciri-ciri berikut:</p>
            <ol>
                <li>Bernapas</li>
                <li>Bergerak</li>
                <li>Butuh Makan (Nutrisi)</li>
                <li>Tumbuh dan Berkembang</li>
                <li>Berkembang Biak (Reproduksi)</li>
                <li>Peka Terhadap Rangsang (Iritabilitas)</li>
                <li>Mengeluarkan Zat Sisa (Ekskresi)</li>
            </ol>
            <hr>
            <h5 class="text-gray-900">Kesimpulan (Generalization)</h5>
            <p>Berdasarkan seluruh kegiatan di modul ini, tuliskan kesimpulanmu tentang apa itu makhluk hidup:</p>
            <form>
                <textarea class="form-control" rows="3"
                          placeholder="Makhluk hidup adalah..."
                          id="kesimpulan_text"
                          oninput="checkKesimpulan()"></textarea>
                <small id="kesimpulan_error" class="text-danger" style="display: none;">Anda harus menulis kesimpulan (minimal 10 karakter) untuk melanjutkan.</small>
            </form>
            <br>
            <button class="btn btn-secondary" onclick="showSlide(4)"><i class="fas fa-arrow-left"></i> Kembali</button>
            <a href="{% url 'selesai_step' 'modul_1' %}"
               id="btn_selesai_modul"
               class="btn btn-success btn-icon-split disabled">
                <span class="icon text-white-50"><i class="fas fa-check"></i></span>
                <span class="text">Selesai Modul & Buka Latihan 1</span>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
<script>
let currentSlide = 1;
function showSlide(slideNumber) {
    document.getElementById('slide-' + currentSlide).classList.remove('active');
    currentSlide = slideNumber;
    document.getElementById('slide-' + currentSlide).classList.add('active');
    if (slideNumber === 5) { checkKesimpulan(); }
}

function checkKesimpulan() {
    const textarea = document.getElementById('kesimpulan_text');
    const button = document.getElementById('btn_selesai_modul');
    const errorMsg = document.getElementById('kesimpulan_error');
    if (textarea.value.trim().length > 10) {
        button.classList.remove('disabled');
        errorMsg.style.display = 'none';
    } else {
        button.classList.add('disabled');
        errorMsg.style.display = textarea.value.length > 0 ? 'block' : 'none';
    }
}

const objects = {
    'Kucing': {
        img: "{% static 'img/kucing.png' %}",
        ciri: {
            'Bernapas': { 'status': true, 'teks': 'YA! Kucing bernapas dengan paru-paru.' },
            'Bergerak': { 'status': true, 'teks': 'YA! Kucing bisa berlari dan melompat.' },
            'Butuh Makan/Nutrisi': { 'status': true, 'teks': 'YA! Kucing makan ikan.' },
            'Tumbuh & Berkembang': { 'status': true, 'teks': 'YA! Anak kucing tumbuh jadi besar.' },
            'Berkembang Biak': { 'status': true, 'teks': 'YA! Kucing melahirkan anak.' },
            'Peka Terhadap Rangsang': { 'status': true, 'teks': 'YA! Kucing merespons saat dipanggil.' },
            'Mengeluarkan Zat Sisa': { 'status': true, 'teks': 'YA! Kucing buang air kecil/besar.' }
        },
        kesimpulan: "MAKHLUK HIDUP"
    },
    'Robot': {
        img: "{% static 'img/robot.png' %}",
        ciri: {
            'Bernapas': { 'status': false, 'teks': 'TIDAK! Robot tidak bernapas.' },
            'Bergerak': { 'status': true, 'teks': 'YA! Robot bisa bergerak dengan baterai.' },
            'Butuh Makan/Nutrisi': { 'status': false, 'teks': 'TIDAK! Robot butuh listrik/baterai.' },
            'Tumbuh & Berkembang': { 'status': false, 'teks': 'TIDAK! Ukuran robot tetap.' },
            'Berkembang Biak': { 'status': false, 'teks': 'TIDAK! Robot tidak bisa punya anak.' },
            'Peka Terhadap Rangsang': { 'status': true, 'teks': 'YA! Robot merespons sensor.' },
            'Mengeluarkan Zat Sisa': { 'status': false, 'teks': 'TIDAK! Robot tidak menghasilkan zat sisa.' }
        },
        kesimpulan: "BENDA MATI"
    }
};

let clickedCount = 0;
const totalCiri = 7;
// Memindahkan referensi checklistDiv ke dalam fungsi agar aman saat loading
// const checklistDiv = document.getElementById('checklist');

function loadObject(namaObjek) {
    const obj = objects[namaObjek];
    document.getElementById('obj-title').innerText = `Objek: ${namaObjek}`;
    document.getElementById('obj-img').src = obj.img;
    document.getElementById('obj-result').innerText = "";
    
    const checklistDiv = document.getElementById('checklist'); 
    checklistDiv.innerHTML = "";
    clickedCount = 0;
    document.getElementById('finish-modul-btn').style.display = 'none';
    document.getElementById('next-obj-btn').style.display = 'none';
    
    for (const [ciri, data] of Object.entries(obj.ciri)) {
        let wrapper = document.createElement('div');
        wrapper.className = 'mb-2';
        let btn = document.createElement('button');
        
        // Menggunakan Ikon FontAwesome
        btn.innerHTML = `<i class="far fa-square mr-2"></i> ${ciri}`;
        btn.id = `btn-${ciri}`;
        btn.className = 'btn btn-outline-primary'; // Default Biru
        
        btn.dataset.namaObjek = namaObjek;
        btn.dataset.ciri = ciri;
        btn.dataset.status = data.status;
        btn.dataset.teks = data.teks;
        btn.onclick = function() { checkCiri(this); };
        wrapper.appendChild(btn);
        
        let teks = document.createElement('span');
        teks.id = `teks-${ciri}`;
        teks.style.marginLeft = '10px';
        teks.className = 'text-gray-700';
        wrapper.appendChild(teks);
        checklistDiv.appendChild(wrapper);
    }
}

function checkCiri(buttonElement) {
    const namaObjek = buttonElement.dataset.namaObjek;
    const ciri = buttonElement.dataset.ciri;
    const status = buttonElement.dataset.status === 'true';
    const teks = buttonElement.dataset.teks;
    const teksSpan = document.getElementById(`teks-${ciri}`);
    
    if (status) {
        // Jika YA (Benar)
        buttonElement.innerHTML = `<i class="fas fa-check-square mr-2"></i> ${ciri}`;
        buttonElement.className = 'btn btn-success';
    } else {
        // Jika TIDAK (Salah)
        buttonElement.innerHTML = `<i class="fas fa-times-circle mr-2"></i> ${ciri}`;
        buttonElement.className = 'btn btn-danger';
    }
    
    teksSpan.innerText = teks;
    buttonElement.disabled = true;
    clickedCount++;
    
    if (clickedCount === totalCiri) {
        document.getElementById('obj-result').innerText = `KESIMPULAN: ${namaObjek} adalah ${objects[namaObjek].kesimpulan}`;
        if (namaObjek === 'Kucing') {
            document.getElementById('next-obj-btn').style.display = 'inline-block';
        } else {
            document.getElementById('finish-modul-btn').style.display = 'inline-block';
        }
    }
}

window.addEventListener("DOMContentLoaded", function() { 
    loadObject('Kucing'); 
});
</script>
{% endblock %}