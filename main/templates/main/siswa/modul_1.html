{% extends 'main/base.html' %}
{% load static %}

{% block title %}Materi 1: Karakteristik Makhluk Hidup{% endblock %}

{% block custom_css %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');

body { font-family: 'Nunito', sans-serif; background: #f0f8ff; }

/* === HEADER === */
.modul-header-card {
    background: white; padding: 1.2rem; border-radius: 1rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 2rem;
    border-left: 6px solid #4e73df; display: flex; justify-content: space-between; align-items: center;
}
.step-badge {
    background: #eef2ff; color: #4e73df; padding: 8px 16px; border-radius: 30px;
    font-weight: 800; letter-spacing: 0.5px; border: 1px solid #d1d3e2;
}

/* === OBJECTIVE BOX (Slide 1) === */
.objective-slide-content {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center; padding: 20px;
}
.objective-box {
    background: #fff; 
    border: 2px solid #e3e6f0;
    border-top: 5px solid #36b9cc;
    border-radius: 15px;
    padding: 40px;
    max-width: 700px;
    margin: 0 auto;
    position: relative;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
}
.objective-box::before {
    content: '\f140'; /* Icon Target */
    font-family: 'Font Awesome 5 Free'; font-weight: 900;
    position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
    background: #36b9cc; color: white; width: 60px; height: 60px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 1.8rem; box-shadow: 0 5px 10px rgba(54, 185, 204, 0.3);
}
.objective-list {
    text-align: left; margin-top: 20px; color: #555; font-size: 1.05rem; line-height: 1.8;
}
.objective-list li { margin-bottom: 10px; }

/* === SLIDES === */
.learning-slide { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
.learning-slide.active { display: block; opacity: 1; }

.learning-card {
    background: white; border-radius: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    padding: 3rem; position: relative; overflow: hidden;
}

h3.title-highlight { color: #2e59d9; font-weight: 900; margin-bottom: 1rem; }
p.text-content { font-size: 1.1rem; color: #555; line-height: 1.8; }

/* === GAMBAR & SUMBER === */
.img-container {
    position: relative; border-radius: 15px; overflow: hidden; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 10px;
    border: 1px solid #eee;
}
.img-content { width: 100%; height: 200px; object-fit: cover; }
.img-source {
    position: absolute; top: 8px; right: 8px;
    background: rgba(0,0,0,0.6); color: #fff; 
    font-size: 0.65rem; padding: 3px 10px; border-radius: 20px;
    font-style: italic; z-index: 10; font-family: sans-serif;
    backdrop-filter: blur(2px);
}

/* === GAME STIMULASI === */
.question-box {
    background: #4e73df; color: white; padding: 15px 30px; border-radius: 50px;
    font-size: 1.1rem; font-weight: 700; text-align: center; margin-bottom: 30px;
    box-shadow: 0 5px 15px rgba(78, 115, 223, 0.3);
    max-width: 550px; margin-left: auto; margin-right: auto;
}
.battle-card {
    cursor: pointer; transition: transform 0.2s, border 0.2s; 
    border: 4px solid transparent; border-radius: 15px; background: #fff;
    padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    max-width: 280px; margin: 0 auto; 
}
.battle-card:hover { transform: scale(1.03); border-color: #d1d3e2; }
.battle-card.selected-correct { border-color: #1cc88a; background: #e8fbf3; }
.battle-card.selected-wrong { border-color: #e74a3b; animation: shake 0.5s; }
@keyframes shake {
  0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 
  50% { transform: translateX(5px); } 100% { transform: translateX(0); }
}

/* === CHECKLIST & CONCLUSION === */
.investigation-area {
    background: #f8f9fc; border-radius: 15px; padding: 20px; border: 2px solid #e3e6f0;
}
.ciri-item {
    background: white; padding: 15px; margin-bottom: 10px; border-radius: 10px;
    display: flex; justify-content: space-between; align-items: center;
    border: 1px solid #eee; transition: 0.2s;
}
.ciri-item:hover { transform: translateX(5px); border-color: #4e73df; }
.ciri-label { font-weight: 700; color: #555; }
.btn-check { border-radius: 20px; padding: 5px 15px; font-size: 0.85rem; }
.result-badge {
    display: none; font-weight: 800; padding: 5px 10px; border-radius: 5px; font-size: 0.85rem;
}
.res-yes { background: #d1e7dd; color: #0f5132; }
.res-no { background: #f8d7da; color: #842029; }
.conclusion-box {
    background: #fff; border: 2px dashed #4e73df; border-radius: 15px; 
    padding: 20px; margin-top: 20px; text-align: center;
    animation: fadeIn 0.5s; box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}
.btn-conclusion { 
    width: 100%; padding: 15px 10px; font-weight: 800; border-radius: 15px; 
    margin-bottom: 15px; font-size: 1.1rem; transition: all 0.2s; border-width: 2px;
}
.btn-conclusion:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
.feedback-container {
    background: #e8fbf3; border: 2px solid #1cc88a; border-radius: 15px;
    padding: 20px; margin-top: 15px; text-align: center; animation: zoomIn 0.3s;
}
.feedback-wrong { background: #fdf2f2; border-color: #e74a3b; }
@keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

/* === TABS MATERI === */
.nav-pills-custom .nav-link {
    border-radius: 50px; font-weight: 700; color: #858796; background: #fff;
    border: 1px solid #e3e6f0; margin-right: 8px; padding: 10px 20px; margin-bottom: 10px;
    text-align: left; transition: 0.3s;
}
.nav-pills-custom .nav-link.active {
    background: #4e73df; color: white; border-color: #4e73df; 
    box-shadow: 0 4px 10px rgba(78, 115, 223, 0.3);
}
.nav-pills-custom .nav-link.read-mark::after {
    content: '\f00c'; font-family: 'Font Awesome 5 Free'; font-weight: 900;
    float: right; color: #1cc88a;
}
.feature-content {
    background: #f8f9fc; border-radius: 15px; padding: 25px; border: 1px solid #e3e6f0;
    display: flex; flex-direction: column; gap: 15px;
}
.split-img-box { display: flex; gap: 10px; height: 180px; width: 100%; }
.half-img {
    flex: 1; position: relative; border-radius: 10px; overflow: hidden;
    box-shadow: 0 4px 5px rgba(0,0,0,0.1);
}
.half-img img { width: 100%; height: 100%; object-fit: cover; }
.half-label {
    position: absolute; bottom: 0; left: 0; width: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
    color: white; font-size: 0.85rem; text-align: center; 
    padding: 20px 5px 8px 5px; font-weight: 700;
    text-shadow: 0 1px 3px rgba(0,0,0,0.8); z-index: 5;
}
.feature-desc { font-size: 1.05rem; line-height: 1.7; color: #444; text-align: justify; border-top: 1px solid #ddd; padding-top: 15px; }
.lock-message { color: #e74a3b; font-size: 0.9rem; font-style: italic; margin-top: 10px; font-weight: bold; }

/* === GAME AKHIR === */
.mission-box {
    background: #36b9cc; color: white; padding: 10px 25px; border-radius: 50px; text-align: center;
    font-weight: 700; font-size: 1rem; margin: 0 auto 30px auto; 
    box-shadow: 0 5px 15px rgba(54, 185, 204, 0.3); max-width: 500px;
}
.target-card {
    background: white; border-radius: 15px; padding: 8px; border: 3px solid #eee;
    cursor: pointer; transition: 0.3s; position: relative; overflow: hidden;
    max-width: 220px; margin: 0 auto; 
}
.target-card:hover { transform: translateY(-5px); border-color: #36b9cc; }
.target-card img { width: 100%; height: 140px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
.target-card h6 { font-weight: 800; color: #555; margin: 0; font-size: 0.95rem; }
.target-card.wrong-pick { border-color: #e74a3b; background: #fdf2f2; animation: shake 0.5s; }
.target-card.correct-pick { border-color: #1cc88a; background: #eefdf6; }
.btn-start-game { font-size: 1rem; padding: 10px 30px; font-weight: 700; }

/* === PAGINATION FOOTER === */
.pagination-footer {
    margin-top: 3rem; padding-top: 1rem; border-top: 1px solid #e3e6f0;
    display: flex; justify-content: space-between; align-items: center;
    flex-wrap: wrap; gap: 10px;
}
.page-numbers-container { display: flex; gap: 5px; }
.btn-page-number {
    width: 35px; height: 35px; border-radius: 50%;
    border: 1px solid #d1d3e2; background: #fff;
    color: #858796; font-weight: 700; font-size: 0.85rem;
    display: flex; align-items: center; justify-content: center;
    transition: 0.2s; cursor: pointer;
}
.btn-page-number.active { background: #4e73df; color: white; border-color: #4e73df; box-shadow: 0 4px 10px rgba(78, 115, 223, 0.3); }
.btn-page-number.unlocked { background: #eefdf6; color: #1cc88a; border-color: #1cc88a; }
.btn-page-number.unlocked:hover { background: #1cc88a; color: white; }
.btn-page-number:disabled { background: #eaecf4; color: #b7b9cc; border-color: #eaecf4; cursor: not-allowed; opacity: 0.7; }
.btn-nav-page { border-radius: 50px; font-weight: 700; padding: 8px 20px; font-size: 0.9rem; transition: 0.2s; }

@media (max-width: 576px) {
    .img-content { height: 180px; }
    .split-img-box { height: 140px; }
    .target-card img { height: 120px; }
    .battle-card { max-width: 100%; } 
    .question-box { width: 100%; border-radius: 15px; }
    .pagination-footer { flex-direction: column-reverse; }
    .page-numbers-container { order: 2; margin-bottom: 10px; }
    .btn-nav-page { width: 100%; order: 1; }
}
</style>
{% endblock %}

{% block content %}

<div class="modul-header-card sticky-top" style="top: 15px; z-index: 99;">
    <div>
        <h5 class="font-weight-bold text-primary m-0"><i class="fas fa-seedling mr-2"></i>Materi 1: Karakteristik Makhluk Hidup</h5>
    </div>
    <div id="step-badge" class="step-badge">1. Pendahuluan</div>
</div>

<div id="slide-1" class="learning-slide active">
    <div class="learning-card text-center">
        
        <div class="objective-slide-content">
            
            <div class="objective-box">
                <h4 class="font-weight-bold text-gray-800">Tujuan Pembelajaran</h4>
                <p class="text-muted small">Setelah mempelajari modul ini, kamu diharapkan mampu:</p>
                <ul class="objective-list">
                    <li><i class="fas fa-check-circle text-info mr-2"></i> <strong>Membedakan</strong> antara makhluk hidup dan benda mati melalui pengamatan ciri fisik.</li>
                    <li><i class="fas fa-check-circle text-info mr-2"></i> <strong>Mengidentifikasi 7 ciri-ciri kehidupan</strong> (bernapas, nutrisi, bergerak, tumbuh, reproduksi, iritabilitas, ekskresi).</li>
                    <li><i class="fas fa-check-circle text-info mr-2"></i> <strong>Menganalisis</strong> karakteristik objek untuk menyimpulkan klasifikasinya.</li>
                </ul>
            </div>
            
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" disabled>
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-1"></div>
            <button class="btn btn-primary btn-nav-page shadow" onclick="changePage(1)">
                Mulai Belajar <i class="fas fa-chevron-right ml-2"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-2" class="learning-slide">
    <div class="learning-card text-center">
        
        <h3 class="title-highlight">Ayo Tebak: Mobil vs Kucing</h3>
        <p class="text-content mb-4">
            Sebelum kita mulai, mari kita bandingkan dua objek ini. 
            <strong>Jawab pertanyaan di kotak biru</strong> dengan menekan gambar yang benar!
        </p>

        <div class="question-box shadow-sm" id="stimulus-question">
            Memuat Pertanyaan...
        </div>

        <div class="row justify-content-center">
            <div class="col-6 col-md-5 mb-3">
                <div class="battle-card" id="card-mobil" onclick="checkStimulus('mobil')">
                    <div class="img-container mb-0 border-0">
                        <img src="{% static 'img/mobil2.jpg' %}" class="img-content rounded" alt="Mobil">
                        <div class="img-source">Sumber: Dok. Pribadi</div>
                    </div>
                    <h5 class="font-weight-bold text-gray-800 mt-2">Mobil</h5>
                </div>
            </div>
            <div class="col-6 col-md-5 mb-3">
                <div class="battle-card" id="card-kucing" onclick="checkStimulus('kucing')">
                    <div class="img-container mb-0 border-0">
                        <img src="{% static 'img/kucing.jpg' %}" class="img-content rounded" alt="Kucing">
                        <div class="img-source">Sumber: Dok. Pribadi</div>
                    </div>
                    <h5 class="font-weight-bold text-gray-800 mt-2">Kucing</h5>
                </div>
            </div>
        </div>

        <div id="stimulus-feedback" class="mt-5" style="display: none;">
            <div class="alert alert-success d-inline-block px-4 py-2 mb-3">
                <i class="fas fa-check-circle"></i> <strong>Hebat!</strong> Pengamatanmu tajam.
            </div>
            <p id="stimulus-msg" class="text-muted font-italic mb-3"></p>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-2"></div>
            <button class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)">
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-3" class="learning-slide">
    <div class="learning-card">
        <h3 class="title-highlight">Pilih Objek Pengamatan</h3>
        <p class="text-content">
            Untuk menjawab pertanyaan tadi, kita akan melakukan <strong>Cek Fisik</strong> pada <strong>4 Objek</strong> ini.
        </p>
        
        <div class="row text-center mt-4">
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/pohon2.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">1. Pohon</h6>
            </div>
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/batu2.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">2. Batu</h6>
            </div>
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/kucing.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">3. Kucing</h6>
            </div>
            <div class="col-6 col-md-3">
                <div class="img-container">
                    <img src="{% static 'img/mobil2.jpg' %}" class="img-content" style="height: 150px;">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h6 class="font-weight-bold">4. Mobil</h6>
            </div>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-3"></div>
            <button class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)">
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-4" class="learning-slide">
    <div class="learning-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="title-highlight m-0">Cek Ciri Kehidupan</h3>
            <span class="badge badge-primary p-2" id="object-counter">Objek 1 dari 4</span>
        </div>

        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="img-container">
                    <img id="current-img" src="" class="img-content">
                    <div class="img-source">Sumber: Dok. Pribadi</div>
                </div>
                <h4 class="font-weight-bold text-gray-800 mt-2 text-center" id="current-name">...</h4>

                <div id="conclusion-area" class="conclusion-box" style="display: none;">
                    <h6 class="font-weight-bold text-primary mb-3">Apa Kesimpulanmu?</h6>
                    
                    <div id="selection-buttons">
                        <button class="btn btn-outline-success btn-conclusion" onclick="verifyConclusion(true)">
                            <i class="fas fa-leaf"></i> MAKHLUK HIDUP
                        </button>
                        <button class="btn btn-outline-secondary btn-conclusion" onclick="verifyConclusion(false)">
                            <i class="fas fa-cube"></i> BENDA MATI
                        </button>
                    </div>

                    <div id="feedback-area" class="feedback-container" style="display:none;">
                        <h5 id="feedback-title" class="font-weight-bold mb-2"></h5>
                        <p id="feedback-msg" class="mb-3" style="line-height: 1.5; font-size: 0.95rem;"></p>
                        
                        <button id="next-object-btn" class="btn btn-primary btn-sm rounded-pill px-4 shadow" onclick="nextObject()">
                            Lanjut Objek Berikutnya <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="investigation-area">
                    <p class="small text-muted mb-3">Klik tombol <strong>"Cek"</strong> untuk memeriksa apakah objek tersebut memiliki ciri berikut:</p>
                    <div id="checklist-box"></div>
                </div>
            </div>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-4"></div>
            <button id="btn-next-4" class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)" disabled>
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-5" class="learning-slide">
    <div class="learning-card">
        <h3 class="title-highlight text-center">Ciri - ciri Makhluk Hidup</h3>
        <p class="text-content text-center mb-4">
            Klik pada <strong>setiap ciri (1-7)</strong> untuk membaca penjelasan lengkap dan mengaktifkan tombol lanjut.
        </p>

        <div class="row">
            <div class="col-md-4">
                <div class="nav flex-column nav-pills nav-pills-custom" role="tablist">
                    <a class="nav-link active" id="tab-1" data-toggle="pill" href="#ciri-1" onclick="markTabRead(1)">1. Bernapas</a>
                    <a class="nav-link" id="tab-2" data-toggle="pill" href="#ciri-2" onclick="markTabRead(2)">2. Memerlukan Nutrisi</a>
                    <a class="nav-link" id="tab-3" data-toggle="pill" href="#ciri-3" onclick="markTabRead(3)">3. Bergerak</a>
                    <a class="nav-link" id="tab-4" data-toggle="pill" href="#ciri-4" onclick="markTabRead(4)">4. Tumbuh & Berkembang</a>
                    <a class="nav-link" id="tab-5" data-toggle="pill" href="#ciri-5" onclick="markTabRead(5)">5. Reproduksi</a>
                    <a class="nav-link" id="tab-6" data-toggle="pill" href="#ciri-6" onclick="markTabRead(6)">6. Iritabilitas</a>
                    <a class="nav-link" id="tab-7" data-toggle="pill" href="#ciri-7" onclick="markTabRead(7)">7. Ekskresi</a>
                </div>
            </div>
            <div class="col-md-8">
                <div class="tab-content">
                    
                    <div class="tab-pane fade show active" id="ciri-1">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/manusiaBernafas.jpg' %}">
                                    <div class="img-source">Sumber: Tribunnewsmaker.com</div>
                                    <div class="half-label">Manusia</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuhanBernafas.jpg' %}">
                                    <div class="img-source">Sumber: thedailyECO</div>
                                    <div class="half-label">Tumbuhan</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Bernapas (Respirasi)</h5>
                                Bernapas adalah proses menghirup oksigen (O2) yang ada di lingkungan dan menghembuskan gas buangan berupa karbondioksida (CO2). Oksigen diperlukan tubuh untuk proses oksidasi (pembakaran) zat makanan guna menghasilkan energi.
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-2">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/hewanMakan.jpg' %}">
                                    <div class="img-source">Sumber: Kompas Regional</div>
                                    <div class="half-label">Hewan</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/pohonKasturi.jpg' %}">
                                    <div class="img-source">Sumber: Generasi Peneliti</div>
                                    <div class="half-label">Tumbuhan</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Memerlukan Makanan (Nutrisi)</h5>
                                Makanan berfungsi sebagai sumber energi, pengganti sel tubuh yang rusak, dan untuk pertumbuhan. Hewan bersifat <em>heterotrof</em> (memakan makhluk hidup lain), sedangkan tumbuhan bersifat <em>autotrof</em> (membuat makanan sendiri melalui fotosintesis).
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-3">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/kucingBergerak.jpeg' %}">
                                    <div class="img-source">Sumber: liputan6.com</div>
                                    <div class="half-label">Hewan (Gerak Aktif)</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuhanPasip.jpg' %}">
                                    <div class="img-source">Sumber: Dok. Kompas.com</div>
                                    <div class="half-label">Tumbuhan (Gerak Pasif)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Bergerak</h5>
                                Hewan dan manusia dapat melakukan gerak aktif (berpindah tempat) menggunakan alat gerak (kaki, sayap, sirip). Tumbuhan melakukan gerak pasif (tidak berpindah tempat), contohnya gerak ujung batang menuju cahaya matahari.
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-4">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuh.jpg' %}">
                                    <div class="img-source">Sumber: Blog StudyHouse</div>
                                    <div class="half-label">Manusia</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/tumbuhan.jpeg' %}">
                                    <div class="img-source">Sumber: Wayground</div>
                                    <div class="half-label">Tumbuhan</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Tumbuh dan Berkembang</h5>
                                <strong>Tumbuh</strong> adalah pertambahan ukuran tubuh yang tidak dapat kembali ke ukuran semula (contoh: tinggi badan bertambah). <strong>Berkembang</strong> adalah proses perubahan menuju kedewasaan (contoh: pematangan fungsi organ reproduksi).
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-5">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/kucingMenyusu.jpg' %}">
                                    <div class="img-source">Sumber: Dok. Pribadi</div>
                                    <div class="half-label">Hewan</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/bertunas.jpg' %}">
                                    <div class="img-source">Sumber: Djawanews.com</div>
                                    <div class="half-label">Tumbuhan (Bertunas)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Berkembang Biak (Reproduksi)</h5>
                                Kemampuan makhluk hidup untuk menghasilkan keturunan. Tujuannya adalah untuk melestarikan jenisnya agar tidak punah. Bisa secara generatif (kawin) maupun vegetatif (tidak kawin).
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-6">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/silau.webp' %}">
                                    <div class="img-source">Sumber: DepositPhotos</div>
                                    <div class="half-label">Manusia (Peka terhadap cahaya)</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/putri.jpg' %}">
                                    <div class="img-source">Sumber: bobo.ID</div>
                                    <div class="half-label">Tumbuhan (Sentuhan)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Peka Terhadap Rangsang (Iritabilitas)</h5>
                                Makhluk hidup mampu menanggapi rangsangan dari lingkungan. Rangsangan dapat berupa cahaya, bunyi, bau, rasa, atau sentuhan. Contoh: Daun putri malu menutup jika disentuh.
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="ciri-7">
                        <div class="feature-content">
                            <div class="split-img-box">
                                <div class="half-img">
                                    <img src="{% static 'img/keringat.jpg' %}">
                                    <div class="img-source">Sumber: www.kumpulanilmu.com</div>
                                    <div class="half-label">Manusia (Keringat)</div>
                                </div>
                                <div class="half-img">
                                    <img src="{% static 'img/uap.jpg' %}">
                                    <div class="img-source">Sumber: Tribunnews.com</div>
                                    <div class="half-label">Tumbuhan (Uap Air)</div>
                                </div>
                            </div>
                            <div class="feature-desc">
                                <h5 class="font-weight-bold">Mengeluarkan Zat Sisa (Ekskresi)</h5>
                                Proses pengeluaran zat sisa metabolisme yang tidak dibutuhkan lagi oleh tubuh. Jika tidak dibuang, zat ini dapat menjadi racun. Contoh: Keringat, urin, dan uap air pernapasan.
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="text-right mt-4">
            <span id="lock-msg" class="lock-message">
                <i class="fas fa-lock"></i> Silakan baca semua ciri (1-7) untuk membuka tombol lanjut di bawah.
            </span>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-5"></div>
            <button id="btn-next-5" class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)" disabled>
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-6" class="learning-slide">
    <div class="learning-card">
        <h3 class="title-highlight text-center">Uji Pemahaman: Analisis Klasifikasi</h3>
        
        <p class="text-content text-center mb-4">
            Perhatikan ketiga objek pada setiap ronde. Analisislah karakteristik dari setiap objek tersebut.
            <br>
            Tentukan <strong>satu objek</strong> yang memiliki klasifikasi berbeda (pengecualian) dibandingkan dua objek lainnya.
        </p>

        <div class="mission-box" id="mission-text">
            Siap? Klik tombol Mulai!
        </div>

        <div class="row justify-content-center" id="game-area" style="display: none;">
            <div class="col-4 col-md-3">
                <div class="target-card" id="option-0" onclick="checkOddOne(0)">
                    <img id="img-0" src="">
                    <div class="img-source" id="source-0">Sumber: -</div>
                    <h6 id="label-0">...</h6>
                </div>
            </div>
            <div class="col-4 col-md-3">
                <div class="target-card" id="option-1" onclick="checkOddOne(1)">
                    <img id="img-1" src="">
                    <div class="img-source" id="source-1">Sumber: -</div>
                    <h6 id="label-1">...</h6>
                </div>
            </div>
            <div class="col-4 col-md-3">
                <div class="target-card" id="option-2" onclick="checkOddOne(2)">
                    <img id="img-2" src="">
                    <div class="img-source" id="source-2">Sumber: -</div>
                    <h6 id="label-2">...</h6>
                </div>
            </div>
        </div>

        <div class="text-center mt-4" id="start-game-btn-area">
            <button class="btn btn-success rounded-pill shadow btn-start-game" onclick="startGameOddOne()">
                <i class="fas fa-play mr-2"></i> Mulai Analisis
            </button>
        </div>

        <div id="game-feedback" class="mt-4 text-center" style="display: none;">
            <h4 class="font-weight-bold" id="feedback-title"></h4>
            <p id="feedback-desc"></p>
            <button id="next-round-btn" class="btn btn-primary rounded-pill px-4" onclick="nextRound()">Lanjut Soal Berikutnya</button>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-6"></div>
            
            <a id="btn-finish-module" href="{% url 'selesai_step' 'modul_1' %}" class="btn btn-success btn-nav-page" style="display: none;">
                Selesai <i class="fas fa-check"></i>
            </a>
        </div>

    </div>
</div>

{% endblock %}

{% block custom_js %}
<script>
// === 1. GLOBAL VARIABLES & STATE ===
const stepNames = ["Pendahuluan", "Stimulasi", "Identifikasi", "Pengumpulan Data", "Konsep", "Pembuktian"];
const totalSlides = 6;
let currentSlideIndex = 1; 

let progressState = {
    1: true,
    2: true, // Stimulasi Awal
    3: true, // Identifikasi (Pilih Objek)
    4: false, // Cek Fisik (Terkunci Awal)
    5: false, // Materi (Terkunci Awal)
    6: false  // Game Akhir (Terkunci Awal)
};

// --- LOGIKA PENYIMPANAN CERDAS (KEMBALI KE ORIGINAL) ---
function loadProgress() {
    // Menggunakan key original 'modul_1_progress'
    const saved = localStorage.getItem('modul_1_progress'); 
    if (saved) {
        progressState = JSON.parse(saved);
        
        // Validasi pembukaan kunci berjenjang (Logic lama diadaptasi ke 6 slide)
        if (progressState[6]) { progressState[5] = true; progressState[4] = true; }
        if (progressState[5]) { progressState[4] = true; }
        
        // Memastikan 3 slide awal selalu terbuka jika pernah diakses
        progressState[1] = true;
        progressState[2] = true;
        progressState[3] = true;
    }
}

function saveProgress() {
    localStorage.setItem('modul_1_progress', JSON.stringify(progressState));
}

// === 2. NAVIGATION LOGIC ===
function nextSlide(n) {
    if (n > currentSlideIndex) {
        // Validasi Kunci (Digeser +1 index dari kode lama)
        if (currentSlideIndex === 4 && !progressState[4]) { // Slide 4 = Cek Fisik
            alert("Selesaikan investigasi pada ke-4 objek terlebih dahulu!");
            return;
        }
        if (currentSlideIndex === 5 && !progressState[5]) { // Slide 5 = Materi
            alert("Harap baca semua materi (1-7) terlebih dahulu!");
            return;
        }
    }

    document.querySelectorAll('.learning-slide').forEach(el => {
        el.classList.remove('active');
        el.style.opacity = 0;
    });
    
    const target = document.getElementById('slide-' + n);
    if(target) {
        target.classList.add('active');
        setTimeout(() => target.style.opacity = 1, 50);
        
        if(stepNames[n-1]) {
            document.getElementById('step-badge').innerText = stepNames[n-1];
        }
        document.querySelector('.modul-header-card').scrollIntoView({behavior: 'smooth'});

        currentSlideIndex = n;
        
        // AUTO UNLOCK logic
        if (n > 1) {
            for(let k=1; k < n; k++) {
                progressState[k] = true;
            }
            saveProgress();
        }

        renderPageNumbers(n);
        checkNextButtonState(n);

        // Trigger functions (Index disesuaikan)
        if (n === 2) initStimulus(); 
        if (n === 4) { 
            if(!progressState[4]) loadInvestigation(0);
            else loadInvestigation(0);
        }
        if (n === 5) markTabRead(1); 
    }
}

function changePage(offset) {
    const targetPage = currentSlideIndex + offset;
    if (targetPage < 1 || targetPage > totalSlides) return;
    nextSlide(targetPage);
}

function renderPageNumbers(slideNum) {
    const container = document.getElementById(`page-numbers-${slideNum}`);
    if(!container) return;

    let html = '';
    for(let i=1; i<=totalSlides; i++) {
        let btnClass = 'btn-page-number';
        let disabledAttr = 'disabled';
        let onClickAttr = '';

        if (i === slideNum) {
            btnClass += ' active'; 
            disabledAttr = ''; 
        } else if (i < slideNum || progressState[i] === true) {
            btnClass += ' unlocked'; 
            disabledAttr = '';
            onClickAttr = `onclick="nextSlide(${i})"`;
        }

        html += `<button class="${btnClass}" ${disabledAttr} ${onClickAttr}>${i}</button>`;
    }
    container.innerHTML = html;
}

function checkNextButtonState(n) {
    // Validasi tombol sesuai slide baru
    if (n === 4) { // Slide Cek Fisik
        const btn = document.getElementById('btn-next-4');
        if (progressState[4]) btn.removeAttribute('disabled');
        else btn.setAttribute('disabled', 'true');
    }
    if (n === 5) { // Slide Materi
        const btn = document.getElementById('btn-next-5');
        const lockMsg = document.getElementById('lock-msg');
        
        if (progressState[5]) {
            btn.removeAttribute('disabled');
            lockMsg.style.display = 'none';
        } else {
            btn.setAttribute('disabled', 'true');
            lockMsg.style.display = 'block';
        }
    }
    if (n === 6) { // Slide Akhir
        const btn = document.getElementById('btn-finish-module');
        if (progressState[6]) btn.style.display = 'inline-block';
        else btn.style.display = 'none';
    }
}

// === 3. SLIDE 2 LOGIC (Stimulasi) ===
const stimulusQuestions = [
    { text: "Mana yang memerlukan nutrisi untuk tumbuh?", answer: 'kucing' },
    { text: "Mana yang bergerak harus menggunakan bahan bakar?", answer: 'mobil' },
    { text: "Mana yang bernafas?", answer: 'kucing' }
];
let stimIndex = 0;

function initStimulus() {
    stimIndex = 0;
    showStimulusQuestion();
}

function showStimulusQuestion() {
    if(stimIndex < stimulusQuestions.length) {
        document.getElementById('stimulus-question').innerText = stimulusQuestions[stimIndex].text;
        ['mobil', 'kucing'].forEach(id => {
            const el = document.getElementById('card-' + id);
            if(el) {
                el.classList.remove('selected-correct', 'selected-wrong');
                el.style.pointerEvents = 'auto';
            }
        });
    } else {
        document.getElementById('stimulus-question').innerText = "Observasi Awal Selesai.";
        ['mobil', 'kucing'].forEach(id => {
            const el = document.getElementById('card-' + id);
            if(el) el.style.pointerEvents = 'none';
        });
    }
}

function checkStimulus(choice) {
    const correct = stimulusQuestions[stimIndex].answer;
    const card = document.getElementById('card-' + choice);
    
    if (choice === correct) {
        card.classList.add('selected-correct');
        setTimeout(() => {
            stimIndex++; 
            showStimulusQuestion();
        }, 800);
    } else {
        card.classList.add('selected-wrong');
        setTimeout(() => { card.classList.remove('selected-wrong'); }, 500);
    }
}

// === 4. SLIDE 4 LOGIC (Investigasi) ===
const investigasiData = [
    { 
        name: "Pohon", 
        img: "{% static 'img/pohon2.jpg' %}", 
        isLiving: true, 
        traits: { 'Bernapas': true, 'Bergerak': true, 'Butuh Makan': true, 'Tumbuh': true, 'Berkembang Biak': true, 'Peka Rangsang': true, 'Ekskresi': true },
        correctMsg: "Betul sekali! Pohon adalah makhluk hidup karena ia bernapas, memerlukan nutrisi, dan tumbuh." 
    },
    { 
        name: "Batu", 
        img: "{% static 'img/batu2.jpg' %}", 
        isLiving: false, 
        traits: { 'Bernapas': false, 'Bergerak': false, 'Butuh Makan': false, 'Tumbuh': false, 'Berkembang Biak': false, 'Peka Rangsang': false, 'Ekskresi': false },
        correctMsg: "Tepat! Batu adalah benda mati. Ia tidak memiliki ciri-ciri kehidupan seperti bernapas atau tumbuh."
    },
    { 
        name: "Kucing", 
        img: "{% static 'img/kucing.jpg' %}", 
        isLiving: true, 
        traits: { 'Bernapas': true, 'Bergerak': true, 'Butuh Makan': true, 'Tumbuh': true, 'Berkembang Biak': true, 'Peka Rangsang': true, 'Ekskresi': true },
        correctMsg: "Benar! Kucing adalah makhluk hidup. Kucing memiliki semua ciri kehidupan yang kompleks."
    },
    { 
        name: "Mobil", 
        img: "{% static 'img/mobil2.jpg' %}", 
        isLiving: false, 
        traits: { 'Bernapas': false, 'Bergerak': true, 'Butuh Makan': false, 'Tumbuh': false, 'Berkembang Biak': false, 'Peka Rangsang': false, 'Ekskresi': false },
        correctMsg: "Benar! Mobil adalah benda mati. Meskipun bergerak, mobil tidak bernapas dan tidak tumbuh secara alami."
    }
];

let currentObjIdx = 0;
let checkedTraits = 0;

function loadInvestigation(idx) {
    currentObjIdx = idx;
    const data = investigasiData[idx];
    document.getElementById('current-name').innerText = data.name;
    document.getElementById('current-img').src = data.img;
    document.getElementById('object-counter').innerText = `Objek ${idx + 1} dari ${investigasiData.length}`;
    
    document.getElementById('conclusion-area').style.display = 'none';
    document.getElementById('checklist-box').innerHTML = '';
    document.getElementById('feedback-area').style.display = 'none';
    document.getElementById('selection-buttons').style.display = 'block';
    checkedTraits = 0;

    for (const [trait, value] of Object.entries(data.traits)) {
        const safeId = trait.replace(/\s/g, '');
        const html = `
            <div class="ciri-item">
                <span class="ciri-label">${trait}?</span>
                <div>
                    <span id="res-${safeId}" class="result-badge"></span>
                    <button class="btn btn-outline-primary btn-check btn-sm" 
                        onclick="revealTrait(this, '${safeId}', ${value})">Cek</button>
                </div>
            </div>`;
        document.getElementById('checklist-box').insertAdjacentHTML('beforeend', html);
    }
}

function revealTrait(btn, safeId, isTrue) {
    const badge = document.getElementById(`res-${safeId}`);
    btn.style.display = 'none';
    badge.style.display = 'inline-block';
    if(isTrue) {
        badge.classList.add('res-yes');
        badge.innerHTML = '<i class="fas fa-check"></i> YA';
    } else {
        badge.classList.add('res-no');
        badge.innerHTML = '<i class="fas fa-times"></i> TIDAK';
    }
    checkedTraits++;
    if(checkedTraits === 7) {
        document.getElementById('conclusion-area').style.display = 'block';
    }
}

function verifyConclusion(studentSaysLiving) {
    const data = investigasiData[currentObjIdx];
    const isCorrect = (studentSaysLiving === data.isLiving);
    
    const feedbackBox = document.getElementById('feedback-area');
    const title = document.getElementById('feedback-title');
    const msg = document.getElementById('feedback-msg');

    document.getElementById('selection-buttons').style.display = 'none';
    feedbackBox.style.display = 'block';

    if (isCorrect) {
        feedbackBox.classList.remove('feedback-wrong');
        title.className = "font-weight-bold mb-2 text-success";
        title.innerHTML = '<i class="fas fa-check-circle"></i> Jawaban Tepat!';
        msg.innerText = data.correctMsg;
    } else {
        feedbackBox.classList.add('feedback-wrong');
        title.className = "font-weight-bold mb-2 text-danger";
        title.innerHTML = '<i class="fas fa-times-circle"></i> Kurang Tepat';
        msg.innerText = "Coba perhatikan lagi ciri-cirinya. Ingat, benda mati tidak memiliki ciri kehidupan lengkap.";
    }

    if (currentObjIdx < investigasiData.length - 1) {
        document.getElementById('next-object-btn').style.display = 'inline-block';
        document.getElementById('next-object-btn').innerHTML = 'Lanjut Objek Berikutnya <i class="fas fa-chevron-right"></i>';
        document.getElementById('next-object-btn').onclick = nextObject;
    } else {
        document.getElementById('next-object-btn').style.display = 'none';
        msg.innerHTML += "<br><br><strong>Semua objek selesai! Silakan tekan tombol 'Selanjutnya' di bawah.</strong>";
        
        progressState[4] = true; // Slide 4 selesai
        saveProgress();
        
        document.getElementById('btn-next-4').removeAttribute('disabled');
        renderPageNumbers(4);
    }
}

function nextObject() {
    currentObjIdx++;
    loadInvestigation(currentObjIdx);
}

// === 5. SLIDE 5 LOGIC (Materi) ===
let viewedTabs = new Set();
const totalTabs = 7;

function markTabRead(n) {
    viewedTabs.add(n);
    document.getElementById('tab-' + n).classList.add('read-mark');
    
    if (viewedTabs.size === totalTabs) {
        document.getElementById('lock-msg').style.display = 'none';
        progressState[5] = true; // Slide 5 selesai
        saveProgress();
        const pagBtn = document.getElementById('btn-next-5');
        if(pagBtn) pagBtn.removeAttribute('disabled');
        renderPageNumbers(5);
    }
}

// === 6. SLIDE 6 LOGIC (Game Akhir) ===
const gameRounds = [
    {
        mission: "Identifikasi objek yang merupakan MAKHLUK HIDUP.",
        correctIdx: 1, 
        items: [
            { name: "Robot", img: "{% static 'img/robot.png' %}", source: "Dok. Canva" },
            { name: "Pohon", img: "{% static 'img/pohon2.jpg' %}", source: "Dok. Pribadi" }, 
            { name: "Air", img: "{% static 'img/air.jpg' %}", source: "Merdeka.com" }
        ]
    },
    {
        mission: "Identifikasi objek yang merupakan BENDA MATI.",
        correctIdx: 2,
        items: [
            { name: "Kucing", img: "{% static 'img/kucing.jpg' %}", source: "Dok. Pribadi" },
            { name: "Jamur", img: "{% static 'img/jamurroti.jpg' %}", source: "Dok. bobo ID" },
            { name: "Meja", img: "{% static 'img/meja.jpg' %}", source: "uwitan" } 
        ]
    },
    {
        mission: "Identifikasi satu-satunya MAKHLUK HIDUP.",
        correctIdx: 0,
        items: [
            { name: "Putri Malu", img: "{% static 'img/putri.jpg' %}", source: "bobo ID" }, 
            { name: "Api", img: "{% static 'img/api.jpg' %}", source: "Dok. Liputan6.com" }, 
            { name: "Mobil", img: "{% static 'img/mobil2.jpg' %}", source: "Dok. Pribadi" }
        ]
    }
];
let roundIdx = 0;

function startGameOddOne() {
    document.getElementById('start-game-btn-area').style.display = 'none';
    document.getElementById('game-area').style.display = 'flex';
    roundIdx = 0;
    loadRound();
}

function loadRound() {
    const data = gameRounds[roundIdx];
    document.getElementById('mission-text').innerHTML = `<i class="fas fa-search mr-2"></i> ${data.mission}`;
    document.getElementById('game-feedback').style.display = 'none';
    
    for(let i=0; i<3; i++) {
        const card = document.getElementById(`option-${i}`);
        card.classList.remove('correct-pick', 'wrong-pick');
        card.style.pointerEvents = 'auto'; 
        document.getElementById(`img-${i}`).src = data.items[i].img;
        document.getElementById(`label-${i}`).innerText = data.items[i].name;
        document.getElementById(`source-${i}`).innerText = "Sumber: " + data.items[i].source;
    }
}

function checkOddOne(pickIdx) {
    const data = gameRounds[roundIdx];
    if (pickIdx === data.correctIdx) {
        document.getElementById(`option-${pickIdx}`).classList.add('correct-pick');
        showFeedback(true);
    } else {
        document.getElementById(`option-${pickIdx}`).classList.add('wrong-pick');
        setTimeout(() => { document.getElementById(`option-${pickIdx}`).classList.remove('wrong-pick'); }, 500);
    }
}

function showFeedback(isSuccess) {
    if(!isSuccess) return;
    for(let i=0; i<3; i++) document.getElementById(`option-${i}`).style.pointerEvents = 'none';

    document.getElementById('game-feedback').style.display = 'block';
    document.getElementById('feedback-title').innerText = "Analisis Tepat!";
    document.getElementById('feedback-title').className = "text-success font-weight-bold";
    document.getElementById('feedback-desc').innerText = "Lanjut ke soal berikutnya.";

    if (roundIdx < gameRounds.length - 1) {
        document.getElementById('next-round-btn').style.display = 'inline-block';
    } else {
        document.getElementById('next-round-btn').style.display = 'none';
        document.getElementById('feedback-desc').innerText = "Selamat! Modul selesai. Tekan tombol Selesai di bawah.";

        document.getElementById('btn-finish-module').style.display = 'inline-block';
        
        progressState[6] = true; // Slide 6 selesai
        saveProgress();
        renderPageNumbers(6);
    }
}

function nextRound() {
    roundIdx++;
    loadRound();
}

// === INIT ===
document.addEventListener('DOMContentLoaded', () => {
    loadProgress(); 
    renderPageNumbers(1);
    checkNextButtonState(1);
});
</script>
{% endblock %}