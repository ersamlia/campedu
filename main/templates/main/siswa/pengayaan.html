{% extends 'main/base.html' %}
{% load static %}
{% block title %}Ujian Akhir Bab{% endblock %}

{% block custom_css %}
    <style>
    /* Mengambil gaya dari modul-modul sebelumnya */
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap');
    body {
        font-family: 'Nunito', sans-serif;
        background: #f3f6fd;
    }
    .learning-card {
        background: #fff;
        border-radius: 2.2rem;
        box-shadow: 0 8px 32px rgba(53,99,233,0.10);
        padding: 2.6rem 5vw 2.2rem 5vw;
        width: 100%;
        max-width: 100%;
        margin: 0 auto 2.5rem auto;
    }
    @media (max-width: 900px) {
        .learning-card { padding: 1.0rem .7rem 1.0rem .7rem; border-radius: 1.08rem; }
    }
    .learning-card .card-header {
        background: transparent;
        border: none;
        font-weight: 800;
        padding: 0;
        margin-bottom: 1.02rem;
    }
    .learning-card .card-header h6 {
        color: #246bfd;
        font-size: 1.13rem;
        font-weight: 900;
        font-family: 'Nunito', sans-serif !important;
        margin-bottom: 0;
    }
    .learning-card .card-body h5, .learning-card .card-body h4 {
        font-family: 'Nunito', sans-serif !important;
        color: #1c253b;
        font-size: 1.19rem;
        font-weight: 800;
        margin-bottom: .58rem;
    }
    /* === AKHIR GAYA BERSAMA === */

    /* Gaya khusus untuk kuis */
    .question-block {
        margin-bottom: 2rem;
        border-bottom: 1px solid #eaf0fb;
        padding-bottom: 1.5rem;
    }
    .question-text {
        font-size: 1.2rem;
        font-weight: 700;
        color: #1c253b;
        margin-bottom: 1rem;
    }
    .choice-label {
        display: block;
        background: #f8f9fc;
        border: 1px solid #e3e6f0;
        border-radius: 0.85rem;
        padding: 1rem 1.5rem;
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
        color: #495466;
        cursor: pointer;
        transition: background-color 0.2s, border-color 0.2s;
    }
    .choice-label:hover {
        background-color: #f0f3ff;
        border-color: #4e73df;
    }
    .choice-label input[type="radio"] {
        margin-right: 12px;
        transform: scale(1.2);
    }
    
    /* === CSS UNTUK TIMER === */
    .quiz-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    .timer-badge {
        background-color: #4e73df;
        color: white;
        padding: 8px 15px;
        border-radius: 0.85rem;
        font-family: 'Nunito', sans-serif;
        font-weight: 700;
        font-size: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    </style>
{% endblock %}

{% block content %}
    <div class="quiz-header">
        <h1 class="h3 text-gray-800 mb-0">Ujian Akhir Bab: {{ pengayaan.judul }}</h1>
        <div class="timer-badge">
            <i class="fas fa-clock"></i> Sisa Waktu: <span id="timer-display">30:00</span> </div>
    </div>

    <div class="learning-card">
        <div class="card-body" style="padding: 1rem 1.5rem;">
            
            <form id="quiz-form" action="{% url 'submit_pengayaan' pengayaan.id %}" method="POST">
                {% csrf_token %}
                
                {% for pertanyaan in pertanyaan %}
                    <div class="question-block">
                        <p class="question-text">{{ forloop.counter }}. {{ pertanyaan.teks_pertanyaan }}</p>
                        
                        <div class="choices">
                            {% for pilihan in pertanyaan.pilihanpengayaan_set.all %}
                            <label class="choice-label">
                                <input type="radio" 
                                       name="pertanyaan_{{ pertanyaan.id }}" 
                                       value="{{ pilihan.id }}" 
                                       required>
                                {{ pilihan.teks_pilihan }}
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                {% empty %}
                    <div class="alert alert-warning">
                        Belum ada pertanyaan yang ditambahkan untuk ujian pengayaan ini.
                    </div>
                {% endfor %}
                
                <hr>
                
                {% if pertanyaan %}
                <button type="submit" class="btn btn-success btn-icon-split" style="border-radius: 0.85rem;">
                    <span class="icon text-white-70"><i class="fas fa-check"></i></span>
                    <span class="text">Kirim Jawaban</span>
                </button>
                {% endif %}
            </form>
        </div>
    </div>
{% endblock %}

{% block custom_js %}
<script>
// --- JAVASCRIPT UNTUK TIMER ---

document.addEventListener('DOMContentLoaded', function() {
    
    // PERUBAHAN DI SINI: Durasi diubah ke 30 menit
    const durationInSeconds = 30 * 60; 
    let timer = durationInSeconds;
    
    const timerDisplay = document.getElementById('timer-display');
    const quizForm = document.getElementById('quiz-form');

    if (!timerDisplay || !quizForm) {
        console.error("Timer atau Form elemen tidak ditemukan!");
        return;
    }

    const interval = setInterval(function () {
        let minutes = Math.floor(timer / 60);
        let seconds = timer % 60;

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        timerDisplay.textContent = minutes + ":" + seconds;

        if (--timer < 0) {
            clearInterval(interval);
            alert("Waktu habis! Jawaban Anda akan dikirim secara otomatis.");
            quizForm.submit();
        }
    }, 1000); 
});
</script>
{% endblock %}