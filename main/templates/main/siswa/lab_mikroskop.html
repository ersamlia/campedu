{% extends 'main/base.html' %}
{% load static %}
{% block title %}Lab Mikroskop Virtual{% endblock %}
{% block custom_css %}
    <style>
    /* === CSS DARI MODUL 2 (UNTUK FONT & CARD) === */
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap');
    body {
        font-family: 'Nunito', sans-serif;
        background: #f3f6fd;
    }
    
    /* === CSS BARU UNTUK JUDUL HALAMAN === */
    .page-title-custom {
        font-family: 'Nunito', sans-serif !important;
        color: #1c253b !important;
        font-weight: 800 !important;
    }
    /* === AKHIR CSS BARU === */

    .learning-card {
        background: #fff;
        border-radius: 2.2rem;
        box-shadow: 0 8px 32px rgba(53,99,233,0.10);
        padding: 2.6rem 5vw 2.2rem 5vw;
        width: 100%;
        max-width: 100%;
        margin: 0 auto 2.5rem auto;
    }
    @media (max-width: 900px) {
        .learning-card { padding: 1.0rem .7rem 1.0rem .7rem; border-radius: 1.08rem; }
    }

    .learning-card .card-header {
        background: transparent;
        border: none;
        border-radius: 2.2rem 2.2rem 0 0;
        font-weight: 800;
        padding: 0;
        margin-bottom: 1.02rem;
    }
    .learning-card .card-header h6 {
        color: #246bfd;
        font-size: 1.13rem;
        font-weight: 900;
        font-family: 'Nunito', sans-serif !important;
        margin-bottom: 0;
        line-height: 1.22;
        letter-spacing: .007em;
    }
    .learning-card .card-body h5, .learning-card .card-body h4 {
        font-family: 'Nunito', sans-serif !important;
        color: #1c253b;
        font-size: 1.19rem;
        font-weight: 800;
        margin-bottom: .58rem;
    }
    .learning-card ul, .learning-card ol {
        margin-left: 1.11rem;
        margin-bottom: 1rem;
        color: #495466;
    }
    .learning-card button.btn-primary {
        background-color: #246bfd;
        font-weight: 700;
        border-radius: 0.85rem;
        border: none;
    }
    .learning-card button.btn-primary:hover,
    .learning-card button.btn-primary:focus {
        background-color: #1c519b;
    }
    .learning-card button.btn-secondary { border-radius: 0.85rem; }
    
    .learning-card button.btn-info {
        border-radius: 0.85rem;
    }
    /* === AKHIR CSS DARI MODUL 2 === */

    /* CSS Khusus untuk Halaman Ini */
    #tampilan-lensa {
        width: 400px;
        height: 400px;
        border: 10px solid #333;
        border-radius: 50%;
        background-color: #f0f0f0;
        background-image: url('{% static "img/lensa_kosong.png" %}');
        background-size: cover;
        background-position: center;
        margin: 0 auto; /* Dibuat auto agar center di card-body */
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    #kotak-preparat .btn {
        display: block;
        width: 100%;
        margin-bottom: 10px;
        text-align: left; /* Teks rata kiri */
    }
    #info-penemuan {
        margin-top: 20px;
        display: none; /* Sembunyi awalnya */
    }
    </style>
{% endblock %}
{% block content %}
    <h1 class="h3 mb-4 text-gray-800 page-title-custom">Lab Mikroskop Virtual</h1>
    <p>Beberapa Kingdom terlalu kecil untuk dilihat. Gunakan mikroskop ini untuk "menemukan" mereka!</p>
    <div class="row">
        <div class="col-lg-7">
            <div class="learning-card">
                <div class="card-header">
                    <h6>Tampilan Lensa Okuler</h6>
                </div>
                <div class="card-body d-flex justify-content-center"
                     style="min-height: 430px;
                            align-items: center;
                            padding: 0">
                    <div id="tampilan-lensa"></div>
                </div>
            </div>
        </div>
        <div class="col-lg-5">
            <div class="learning-card">
                <div class="card-header">
                    <h6>Kotak Preparat</h6>
                </div>
                <div class="card-body" id="kotak-preparat">
                    <p>Klik preparat untuk mengamatinya:</p>
                    <button class="btn btn-info" onclick="pilihPreparat('protista')">
                        <i class="fas fa-fw fa-tint"></i> Preparat 1: Air Kolam
                    </button>
                    <button class="btn btn-info" onclick="pilihPreparat('monera')">
                        <i class="fas fa-fw fa-bacterium"></i> Preparat 2: Bakteri
                    </button>
                    <button class="btn btn-info" onclick="pilihPreparat('fungi')">
                        <i class="fas fa-fw fa-bread-slice"></i> Preparat 3: Jamur Roti
                    </button>
                    <hr class="my-3">
                    <button class="btn btn-secondary" onclick="pilihPreparat('kosong')">
                        <i class="fas fa-fw fa-times"></i> Lepas Preparat
                    </button>
                </div>
            </div>
            <div id="info-penemuan"
                 class="learning-card mb-3"
                 style="padding: 1.5rem 1.8rem;
                        display: none">
                <div class="card-body" style="padding: 0;">
                    <h5 id="info-judul" class="text-primary"></h5>
                    <p id="info-teks" class="mb-0"></p>
                </div>
            </div>
            <a href="{% url 'selesai_step' 'mikroskop' %}"
               id="tombol-lanjut-modul-3"
               class="btn btn-success btn-icon-split"
               style="display:none;
                      border-radius: 0.85rem">
                <span class="icon text-white-50">
                    <i class="fas fa-check"></i>
                </span>
                <span class="text">Selesai Lab & Lanjut ke Modul 3</span>
            </a>
        </div>
    </div>
{% endblock %}
{% block custom_js %}
    <script>
    // Data untuk Mikroskop Virtual
    const dataPreparat = {
        'protista': {
            img: "{% static 'img/protista.jpg' %}",
            judul: "PENEMUAN: Kingdom Protista!",
            teks: "Lihat! Ini adalah Paramecium. Organisme ini bersel satu tapi sudah punya membran inti (eukariotik). Mereka hidup di air."
        },
        'monera': {
            img: "{% static 'img/bakteri.jpg' %}",
            judul: "PENEMUAN: Kingdom Monera!",
            teks: "Ini adalah Bakteri. Ciri utamanya adalah bersel satu dan TIDAK punya membran inti (prokariotik)."
        },
        'fungi': {
            img: "{% static 'img/jamur_roti.jpg' %}",
            judul: "PENEMUAN: Kingdom Fungi!",
            teks: "Ini adalah jamur roti. Perhatikan, tubuhnya terdiri dari benang-benang halus (hifa) dan kotak spora (sporangium)."
        },
        'kosong': {
            img: "{% static 'img/lensa_kosong.png' %}",
            judul: "Meja Preparat Kosong",
            teks: "Silakan pilih salah satu preparat untuk mulai mengamati."
        }
    };

    const lensa = document.getElementById('tampilan-lensa');
    const infoBox = document.getElementById('info-penemuan');
    const infoJudul = document.getElementById('info-judul');
    const infoTeks = document.getElementById('info-teks');

    let preparatDilihat = new Set();
    const tombolLanjut = document.getElementById('tombol-lanjut-modul-3');

    function pilihPreparat(id) {
        const data = dataPreparat[id];
        
        // 1. Ganti gambar di lensa
        lensa.style.backgroundImage = `url(${data.img})`;
        
        // 2. Siapkan data untuk info box
        infoJudul.innerText = data.judul;
        let baseTeks = data.teks; 
        infoBox.style.display = 'block';

        // 3. Lacak progres
        if (id !== 'kosong') {
            preparatDilihat.add(id);
        }

        // 4. Cek apakah sudah selesai
        if (preparatDilihat.size >= 3) {
            tombolLanjut.style.display = 'inline-block'; 
            
            if (id !== 'kosong') {
                baseTeks += "\n\nðŸŽ‰ Kerja bagus! Anda telah menemukan semua spesimen. Silakan lanjut ke modul berikutnya.";
            }
        }
        
        // 5. Tampilkan teks di info box
        infoTeks.innerText = baseTeks;
    }

    // Tampilkan info 'kosong' saat pertama dimuat
    pilihPreparat('kosong');
    </script>
{% endblock %}
