{% extends 'main/base.html' %}
{% load static %}

{% block title %}Modul 3: Menjelajah 5 Kingdom{% endblock %}

{% block custom_css %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');
body { font-family: 'Nunito', sans-serif; background: #f0f8ff; }

/* === GLOBAL HEADER === */
.modul-header-card {
    background: white; padding: 1.2rem; border-radius: 1rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 2rem;
    border-left: 6px solid #4e73df; display: flex; justify-content: space-between; align-items: center;
}
.step-badge {
    background: #eef2ff; color: #4e73df; padding: 8px 16px; border-radius: 30px;
    font-weight: 800; letter-spacing: 0.5px; border: 1px solid #d1d3e2;
}

/* === CARD & SLIDES === */
.learning-slide { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
.learning-slide.active { display: block; opacity: 1; }

.learning-card {
    background: white; border-radius: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    padding: 3rem; position: relative; overflow: hidden;
}

h3.title-highlight { color: #2e59d9; font-weight: 900; margin-bottom: 1rem; }
p.text-content { font-size: 1.1rem; color: #555; line-height: 1.8; }

/* === SLIDE 1: STIMULASI === */
.bio-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
.bio-item { border-radius: 10px; overflow: hidden; height: 150px; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.3s; }
.bio-item:hover { transform: scale(1.05); }
.bio-item img { width: 100%; height: 100%; object-fit: cover; }
.bio-label { position: absolute; bottom: 0; width: 100%; padding: 5px; background: rgba(0,0,0,0.6); color: white; font-size: 0.8rem; text-align: center; font-weight: 700; }

/* Info Box Tokoh (Whittaker) */
.tokoh-box {
    background: #fff3cd; border: 2px solid #ffeeba; border-radius: 15px; padding: 20px;
    display: flex; align-items: flex-start; gap: 15px; text-align: left; margin-top: 25px;
}
.tokoh-icon { font-size: 2.5rem; color: #856404; }
.tokoh-text h5 { font-weight: 800; color: #856404; margin-bottom: 5px; }
.tokoh-text p { font-size: 1rem; color: #533f03; margin-bottom: 0; line-height: 1.5; }

/* === SLIDE 2: FLIP CARD === */
.quiz-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px; }
.quiz-card { background-color: transparent; width: 280px; height: 320px; perspective: 1000px; cursor: pointer; }
.quiz-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
.quiz-card.flipped .quiz-inner { transform: rotateY(180deg); }
.quiz-front, .quiz-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
.quiz-front { background-color: #fff; border: 2px solid #e3e6f0; }
.quiz-back { background-color: #4e73df; color: white; transform: rotateY(180deg); }
.quiz-img { width: 120px; height: 120px; object-fit: cover; border-radius: 50%; margin-bottom: 15px; border: 4px solid #f8f9fc; }
.btn-flip { margin-top: 15px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; }

/* === SLIDE 3: ENSIKLOPEDIA === */
.nav-pills-custom .nav-link { border-radius: 50px; font-weight: 700; color: #858796; background: #fff; border: 1px solid #e3e6f0; margin-right: 8px; padding: 10px 20px; white-space: nowrap; }
.nav-pills-custom .nav-link.active { background: #4e73df; color: white; border-color: #4e73df; box-shadow: 0 4px 10px rgba(78, 115, 223, 0.3); }
.nav-pills-custom .nav-link.read-mark::after { content: '\f00c'; font-family: 'Font Awesome 5 Free'; font-weight: 900; float: right; color: #1cc88a; margin-left: 5px; }
.static-info-box { background: #f8f9fc; border-left: 5px solid #4e73df; padding: 25px; border-radius: 10px; margin-bottom: 25px; }
.static-info-box p { font-size: 1.05rem; line-height: 1.6; color: #444; } 
.key-badge { background: #4e73df; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; display: inline-block; }
.sub-filter-container { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; flex-wrap: wrap; }
.btn-sub { background: white; border: 1px solid #d1d3e2; color: #555; font-size: 0.85rem; padding: 6px 15px; border-radius: 20px; font-weight: 700; white-space: nowrap; transition: 0.2s; }
.btn-sub:hover, .btn-sub.active { background: #36b9cc; color: white; border-color: #36b9cc; transform: translateY(-2px); }
.sub-desc { font-size: 1rem; line-height: 1.6; color: #333; margin-bottom: 20px; padding: 15px; background: #fff; border-radius: 10px; border-left: 4px solid #36b9cc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; animation: fadeIn 0.5s; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.gallery-item { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 6px rgba(0,0,0,0.1); transition: transform 0.2s; border: 1px solid #e3e6f0; }
.gallery-item:hover { transform: scale(1.05); border-color: #4e73df; }
.gallery-item img { width: 100%; height: 120px; object-fit: cover; }
.gallery-caption { padding: 10px; font-size: 0.9rem; text-align: center; font-weight: 700; color: #444; background: #fff; border-top: 1px solid #f0f0f0; line-height: 1.2; }

/* === SLIDE 4: INSPECTOR === */
.inspector-wrapper { display: flex; gap: 20px; justify-content: center; margin-top: 20px; align-items: flex-start; flex-wrap: wrap; }
.inspector-group { width: 45%; min-width: 250px; flex: 1; display: flex; flex-direction: column; }
.inspector-card { width: 100%; height: 200px; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 2px solid #e3e6f0; background: white; }
.inspector-card img { width: 100%; height: 100%; object-fit: cover; }
.inspector-info { margin-top: 15px; padding: 15px; border-radius: 10px; background: white; border-left: 4px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: none; animation: slideUp 0.3s ease-out; }
.inspector-info .info-text { font-size: 1.1rem !important; line-height: 1.5; color: #333; font-weight: 700; }
@keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.info-green { border-left-color: #1cc88a; }
.info-orange { border-left-color: #f6c23e; }
.info-blue { border-left-color: #4e73df; }
.info-red { border-left-color: #e74a3b; }
.inspector-controls { width: 100%; display: flex; justify-content: center; gap: 10px; margin-top: 25px; flex-wrap: wrap; }
.btn-inspect { border-radius: 30px; padding: 8px 20px; font-weight: 700; background: white; border: 2px solid #d1d3e2; color: #555; transition: 0.2s; }
.btn-inspect:hover, .btn-inspect.active { background: #4e73df; color: white; border-color: #4e73df; transform: translateY(-3px); box-shadow: 0 4px 10px rgba(78, 115, 223, 0.2); }

/* === SLIDE 5: GAME AREA === */
.game-area { background: #f1f5f9; border-radius: 20px; padding: 20px; border: 3px dashed #cbd5e1; }
.bucket-container { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 30px; align-items: flex-start; }
.bucket { flex: 1; min-width: 160px; min-height: 200px; background: white; border-radius: 12px; border: 2px solid transparent; padding: 15px 10px; text-align: center; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
.bucket.hover { background: #e0f2fe; border-color: #0ea5e9; transform: translateY(-5px); }
.bucket-icon { font-size: 2rem; margin-bottom: 8px; opacity: 0.7; }
.bucket-name { font-size: 0.85rem; font-weight: 800; text-transform: uppercase; color: #64748b; margin-bottom: 12px; border-bottom: 2px solid #eaecf4; width: 100%; padding-bottom: 8px; }
.bucket-content { display: flex; flex-direction: column; gap: 8px; width: 100%; flex-grow: 1; }
.pool-container { background: white; padding: 25px; border-radius: 15px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; min-height: 130px; box-shadow: inset 0 0 15px rgba(0,0,0,0.05); border: 1px solid #e3e6f0; }
.drag-item { width: 100px; height: 100px; border-radius: 12px; overflow: hidden; cursor: grab; border: 3px solid white; box-shadow: 0 5px 10px rgba(0,0,0,0.1); transition: transform 0.2s; position: relative; background: #fff; z-index: 10; }
.drag-item:active { cursor: grabbing; transform: scale(0.95); box-shadow: 0 8px 15px rgba(0,0,0,0.15); }
.drag-item img { width: 100%; height: 100%; object-fit: cover; }
.drag-label { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.75); color: white; font-size: 0.7rem; text-align: center; padding: 3px 0; font-weight: 700; pointer-events: none; }
.bucket-card { background: #f8f9fc; border: 1px solid #e3e6f0; border-left: 4px solid #1cc88a; padding: 10px; border-radius: 8px; display: flex; align-items: center; gap: 10px; text-align: left; width: 100%; box-shadow: 0 2px 4px rgba(0,0,0,0.05); animation: popIn 0.3s ease-out; }
.bucket-card img { width: 45px; height: 45px; border-radius: 6px; object-fit: cover; flex-shrink: 0; border: 1px solid #ddd; }
.bucket-card div { line-height: 1.3; flex: 1; }
.bucket-card strong { display: block; margin-bottom: 2px; font-size: 1rem !important; color: #2e384d; }
.bucket-card .text-muted { font-size: 0.9rem !important; color: #555 !important; display: block; }

/* Animasi Shake & Toast */
.shake-anim { animation: shake 0.5s; border-color: #e74a3b !important; }
@keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
#game-toast { visibility: hidden; min-width: 250px; background-color: #e74a3b; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 1000; bottom: 30px; left: 50%; transform: translateX(-50%); box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-weight: bold; opacity: 0; transition: opacity 0.5s, bottom 0.5s; font-size: 1rem; }
#game-toast.show { visibility: visible; opacity: 1; bottom: 50px; }

/* === PAGINATION FOOTER === */
.pagination-footer {
    margin-top: 3rem; padding-top: 1rem; border-top: 1px solid #e3e6f0;
    display: flex; justify-content: space-between; align-items: center;
    flex-wrap: wrap; gap: 10px;
}
.page-numbers-container { display: flex; gap: 5px; }
.btn-page-number {
    width: 35px; height: 35px; border-radius: 50%;
    border: 1px solid #d1d3e2; background: #fff;
    color: #858796; font-weight: 700; font-size: 0.85rem;
    display: flex; align-items: center; justify-content: center;
    transition: 0.2s; cursor: pointer;
}
.btn-page-number.active { background: #4e73df; color: white; border-color: #4e73df; box-shadow: 0 4px 10px rgba(78, 115, 223, 0.3); }
.btn-page-number.unlocked { background: #eefdf6; color: #1cc88a; border-color: #1cc88a; }
.btn-page-number.unlocked:hover { background: #1cc88a; color: white; }
.btn-page-number:disabled { background: #eaecf4; color: #b7b9cc; border-color: #eaecf4; cursor: not-allowed; opacity: 0.7; }
.btn-nav-page { border-radius: 50px; font-weight: 700; padding: 8px 20px; font-size: 0.9rem; transition: 0.2s; }

@media (max-width: 768px) {
    .bio-grid { grid-template-columns: repeat(2, 1fr); }
    .bucket { min-width: 45%; } 
    .inspector-group { width: 100%; }
    .inspector-card { height: 180px; }
    .nav-pills-custom { flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; }
    .pagination-footer { flex-direction: column-reverse; }
    .page-numbers-container { order: 2; margin-bottom: 10px; }
    .btn-nav-page { width: 100%; order: 1; }
}
</style>
{% endblock %}

{% block content %}

<div class="modul-header-card sticky-top" style="top: 15px; z-index: 99;">
    <div>
        <h5 class="font-weight-bold text-primary m-0"><i class="fas fa-layer-group mr-2"></i>Materi 3: Makhluk Hidup dengan Klasifikasi 5 Kingdom</h5>
    </div>
    <div id="step-badge" class="step-badge">1. Stimulasi</div>
</div>

<div id="slide-1" class="learning-slide active">
    <div class="learning-card text-center">
        <h3 class="title-highlight">Keanekaragaman Makhluk Hidup</h3>
        <p class="text-content">
            Perhatikan alam sekitar kita. Tuhan menciptakan jutaan makhluk hidup dengan bentuk dan ukuran yang berbeda. 
        </p>
        <div class="bio-grid">
            <div class="bio-item"><img src="{% static 'img/kucing.jpeg' %}"><div class="bio-label">Hewan</div></div>
            <div class="bio-item"><img src="{% static 'img/lumut.jpeg' %}"><div class="bio-label">Tumbuhan</div></div>
            <div class="bio-item"><img src="{% static 'img/jamurroti.jpg' %}"><div class="bio-label">Jamur</div></div>
            <div class="bio-item"><img src="{% static 'img/bakteriecoli.jpeg' %}"><div class="bio-label">Bakteri</div></div>
        </div>
        
        <div class="tokoh-box">
            <div class="tokoh-icon"><i class="fas fa-user-graduate"></i></div>
            <div class="tokoh-text">
                <h5>Siapa Penemunya?</h5>
                <p>
                    Sistem klasifikasi yang kita pelajari saat ini adalah <strong>Sistem 5 Kingdom</strong> yang dicetuskan oleh <strong>Robert H. Whittaker</strong> pada tahun <strong>1969</strong>. 
                    <br>Ia mengelompokkan makhluk hidup berdasarkan <em>struktur sel</em> (prokariotik/eukariotik), <em>cara memperoleh nutrisi</em> (autotrof/heterotrof), dan <em>susunan tubuh</em> (uniseluler/multiseluler).
                </p>
            </div>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)" disabled>
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-1"></div>
            <button id="btn-next-1" class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)">
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-2" class="learning-slide">
    <div class="learning-card text-center">
        <h3 class="title-highlight">Cek Klasifikasi</h3>
        <p class="text-content mb-4">Tebak klasifikasi makhluk di bawah ini. <strong>Balikkan semua kartu</strong> untuk lanjut!</p>
        <div class="quiz-container">
            <div class="quiz-card" onclick="flipCard(this, 1)">
                <div class="quiz-inner">
                    <div class="quiz-front">
                        <img src="{% static 'img/jamurroti.jpg' %}" class="quiz-img">
                        <h5 class="font-weight-bold text-dark">Jamur Roti</h5>
                        <p class="text-muted small">Tumbuh di tanah, tidak bergerak. Apakah aku Tumbuhan?</p>
                        <button class="btn btn-outline-primary btn-sm btn-flip">Cek Jawaban</button>
                    </div>
                    <div class="quiz-back">
                        <h5 class="font-weight-bold"><i class="fas fa-times-circle text-warning"></i> BUKAN!</h5>
                        <p class="small">Aku tidak punya klorofil. Aku kingdom <strong>FUNGI</strong>.</p>
                    </div>
                </div>
            </div>
            <div class="quiz-card" onclick="flipCard(this, 2)">
                <div class="quiz-inner">
                    <div class="quiz-front">
                        <img src="{% static 'img/bakteriecoli.jpeg' %}" class="quiz-img">
                        <h5 class="font-weight-bold text-dark">Bakteri</h5>
                        <p class="text-muted small">Aku sangat kecil dan selku sederhana. Hewan atau bukan?</p>
                        <button class="btn btn-outline-primary btn-sm btn-flip">Cek Jawaban</button>
                    </div>
                    <div class="quiz-back">
                        <h5 class="font-weight-bold"><i class="fas fa-check-circle text-warning"></i> MONERA</h5>
                        <p class="small">Inti selku tidak punya membran (Prokariotik). Aku <strong>MONERA</strong>.</p>
                    </div>
                </div>
            </div>
            <div class="quiz-card" onclick="flipCard(this, 3)">
                <div class="quiz-inner">
                    <div class="quiz-front">
                        <img src="{% static 'img/Amoeba.jpeg' %}" class="quiz-img">
                        <h5 class="font-weight-bold text-dark">Amoeba</h5>
                        <p class="text-muted small">Bergerak lincah tapi cuma satu sel. Hewan?</p>
                        <button class="btn btn-outline-primary btn-sm btn-flip">Cek Jawaban</button>
                    </div>
                    <div class="quiz-back">
                        <h5 class="font-weight-bold"><i class="fas fa-question-circle text-warning"></i> PROTISTA</h5>
                        <p class="small">Aku bukan hewan sejati. Aku masuk <strong>PROTISTA</strong>.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-2"></div>
            <button id="btn-next-2" class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)" disabled>
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-3" class="learning-slide">
    <div class="learning-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="title-highlight m-0">Macam - macam 5 Kingdom</h3>
            <small class="text-muted">Buka semua tab Kingdom untuk lanjut</small>
        </div>

        <ul class="nav nav-pills nav-pills-custom mb-3" id="pills-tab" role="tablist">
            <li class="nav-item"><a class="nav-link active" id="tab-btn-monera" data-toggle="pill" href="#tab-monera" onclick="trackTab('monera')">1. Monera</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-btn-protista" data-toggle="pill" href="#tab-protista" onclick="trackTab('protista')">2. Protista</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-btn-fungi" data-toggle="pill" href="#tab-fungi" onclick="trackTab('fungi')">3. Fungi</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-btn-plantae" data-toggle="pill" href="#tab-plantae" onclick="trackTab('plantae')">4. Plantae</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-btn-animalia" data-toggle="pill" href="#tab-animalia" onclick="trackTab('animalia')">5. Animalia</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab-monera">
                <div class="static-info-box" style="border-left-color: #e74a3b;">
                    <span class="key-badge" style="background: #e74a3b;">Kunci: Prokariotik</span>
                    <h5 class="font-weight-bold text-gray-800">Kingdom Monera</h5>
                    <p class="mb-0">
                        Anggota kingdom ini adalah organisme yang paling sederhana. Tubuhnya terdiri dari satu sel (<strong>Uniseluler</strong>). Ciri utamanya adalah <strong>Prokariotik</strong>, yaitu inti selnya belum memiliki membran inti.
                    </p>
                </div>
                <div class="sub-filter-container">
                    <button class="btn btn-sub active" onclick="showContent('monera','bakteri',this)">Bakteri</button>
                    <button class="btn btn-sub" onclick="showContent('monera','alga',this)">Ganggang Biru</button>
                </div>
                <div id="monera-bakteri" class="content-sect">
                    <div class="sub-desc"><strong>Bakteri (Bacteria):</strong> Organisme mikroskopis yang tidak memiliki klorofil (heterotrof).</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/bakteriecoli.jpeg' %}"><div class="gallery-caption">E. coli</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Lactobacillus.jpg' %}"><div class="gallery-caption">Lactobacillus</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Salmonella.jpg' %}"><div class="gallery-caption">Salmonella</div></div>
                    </div>
                </div>
                <div id="monera-alga" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Ganggang Biru:</strong> Memiliki klorofil (autotrof).</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/oscillatoria.jpg' %}"><div class="gallery-caption">Oscillatoria</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Spirulina.jpg' %}"><div class="gallery-caption">Spirulina</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Anabaena.jpg' %}"><div class="gallery-caption">Anabaena</div></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-protista">
                <div class="static-info-box" style="border-left-color: #36b9cc;">
                    <span class="key-badge" style="background: #36b9cc;">Kunci: Eukariotik Sederhana</span>
                    <h5 class="font-weight-bold text-gray-800">Kingdom Protista</h5>
                    <p class="mb-0">Organisme <strong>Eukariotik</strong> yang bukan hewan, tumbuhan, atau jamur. Sebagian besar uniseluler.</p>
                </div>
                <div class="sub-filter-container">
                    <button class="btn btn-sub active" onclick="showContent('protista','hewan',this)">Mirip Hewan</button>
                    <button class="btn btn-sub" onclick="showContent('protista','tumbuhan',this)">Mirip Tumbuhan</button>
                    <button class="btn btn-sub" onclick="showContent('protista','jamur',this)">Mirip Jamur</button>
                </div>
                <div id="protista-hewan" class="content-sect">
                    <div class="sub-desc"><strong>Protozoa:</strong> Bergerak aktif, tidak berklorofil.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/paramecium.jpg' %}"><div class="gallery-caption">Paramecium</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Amoeba.jpeg' %}"><div class="gallery-caption">Amoeba</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Plasmodium.webp' %}"><div class="gallery-caption">Plasmodium</div></div>
                    </div>
                </div>
                <div id="protista-tumbuhan" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Alga:</strong> Memiliki klorofil, belum punya akar/batang sejati.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/algahijau.jpg' %}"><div class="gallery-caption">Ulva</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Spirogyra.jpg' %}"><div class="gallery-caption">Spirogyra</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Eucheuma.jpg' %}"><div class="gallery-caption">Eucheuma</div></div>
                    </div>
                </div>
                <div id="protista-jamur" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Mirip Jamur:</strong> Heterotrof dan berspora.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/jamurlendir.jpg' %}"><div class="gallery-caption">Jamur Lendir</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Saprolegnia.jpg' %}"><div class="gallery-caption">Saprolegnia</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Phytophthora.webp' %}"><div class="gallery-caption">Phytophthora</div></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-fungi">
                <div class="static-info-box" style="border-left-color: #f6c23e;">
                    <span class="key-badge" style="background: #f6c23e;">Kunci: Heterotrof (Saprofit)</span>
                    <h5 class="font-weight-bold text-gray-800">Kingdom Fungi (Jamur)</h5>
                    <p class="mb-0">Organisme eukariotik berdinding sel kitin. Tidak berklorofil, hidup sebagai pengurai.</p>
                </div>
                <div class="sub-filter-container">
                    <button class="btn btn-sub active" onclick="showContent('fungi','zygo',this)">Zygomycota</button>
                    <button class="btn btn-sub" onclick="showContent('fungi','asco',this)">Ascomycota</button>
                    <button class="btn btn-sub" onclick="showContent('fungi','basi',this)">Basidiomycota</button>
                    <button class="btn btn-sub" onclick="showContent('fungi','deut',this)">Deuteromycota</button>
                </div>
                <div id="fungi-zygo" class="content-sect">
                    <div class="sub-desc"><strong>Zygomycota:</strong> Hifa tidak bersekat. Contoh: Jamur Tempe.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/jamurroti.jpg' %}"><div class="gallery-caption">Rhizopus</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Mucor.jpg' %}"><div class="gallery-caption">Mucor</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Pilobolus.jpg' %}"><div class="gallery-caption">Pilobolus</div></div>
                    </div>
                </div>
                <div id="fungi-asco" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Ascomycota:</strong> Spora dalam kantung (askus).</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/ragi.jpg' %}"><div class="gallery-caption">Ragi</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Penicillium.jpg' %}"><div class="gallery-caption">Penicillium</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Neurospora.png' %}"><div class="gallery-caption">Neurospora</div></div>
                    </div>
                </div>
                <div id="fungi-basi" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Basidiomycota:</strong> Jamur makroskopis berbentuk payung.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/jamurtiram.jpg' %}"><div class="gallery-caption">Jamur Tiram</div></div>
                        <div class="gallery-item"><img src="{% static 'img/jamurMerang.webp' %}"><div class="gallery-caption">Jamur Merang</div></div>
                        <div class="gallery-item"><img src="{% static 'img/JamurKuping.jpeg' %}"><div class="gallery-caption">Jamur Kuping</div></div>
                    </div>
                </div>
                <div id="fungi-deut" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Deuteromycota:</strong> Jamur tidak sempurna (reproduksi seksual belum diketahui).</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/TineaVersicolor.webp' %}"><div class="gallery-caption">Tinea (Panu)</div></div>
                        <div class="gallery-item"><img src="{% static 'img/CandidaAlbicans.webp' %}"><div class="gallery-caption">Candida</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Epidermophyton.webp' %}"><div class="gallery-caption">Epidermophyton</div></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-plantae">
                <div class="static-info-box" style="border-left-color: #1cc88a;">
                    <span class="key-badge" style="background: #1cc88a;">Kunci: Autotrof (Fotosintesis)</span>
                    <h5 class="font-weight-bold text-gray-800">Kingdom Plantae</h5>
                    <p class="mb-0">Organisme multiseluler berklorofil yang mampu berfotosintesis.</p>
                </div>
                <div class="sub-filter-container">
                    <button class="btn btn-sub active" onclick="showContent('plantae','bryo',this)">Lumut</button>
                    <button class="btn btn-sub" onclick="showContent('plantae','pteri',this)">Paku</button>
                    <button class="btn btn-sub" onclick="showContent('plantae','sperma',this)">Biji</button>
                </div>
                <div id="plantae-bryo" class="content-sect">
                    <div class="sub-desc"><strong>Bryophyta:</strong> Belum memiliki pembuluh angkut.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/lumut.jpeg' %}"><div class="gallery-caption">Lumut Daun</div></div>
                        <div class="gallery-item"><img src="{% static 'img/LumutHati.webp' %}"><div class="gallery-caption">Lumut Hati</div></div>
                        <div class="gallery-item"><img src="{% static 'img/LumutTanduk.png' %}"><div class="gallery-caption">Lumut Tanduk</div></div>
                    </div>
                </div>
                <div id="plantae-pteri" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Pteridophyta:</strong> Memiliki pembuluh, berspora.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/suplir.jpeg' %}"><div class="gallery-caption">Suplir</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Paku.jpg' %}"><div class="gallery-caption">Paku Ekor Kuda</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Semanggi.png' %}"><div class="gallery-caption">Semanggi</div></div>
                    </div>
                </div>
                <div id="plantae-sperma" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Spermatophyta:</strong> Tumbuhan berbiji.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/jagung3.jpg' %}"><div class="gallery-caption">Jagung</div></div>
                        <div class="gallery-item"><img src="{% static 'img/mawar.jpeg' %}"><div class="gallery-caption">Mawar</div></div>
                        <div class="gallery-item"><img src="{% static 'img/melinjo.jpeg' %}"><div class="gallery-caption">Melinjo</div></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-animalia">
                <div class="static-info-box" style="border-left-color: #4e73df;">
                    <span class="key-badge" style="background: #4e73df;">Kunci: Heterotrof & Bergerak</span>
                    <h5 class="font-weight-bold text-gray-800">Kingdom Animalia</h5>
                    <p class="mb-0">Organisme multiseluler kompleks, tidak berdinding sel, dapat bergerak aktif.</p>
                </div>
                <div class="sub-filter-container">
                    <button class="btn btn-sub active" onclick="showContent('animalia','inv',this)">Invertebrata</button>
                    <button class="btn btn-sub" onclick="showContent('animalia','vert',this)">Vertebrata</button>
                </div>
                <div id="animalia-inv" class="content-sect">
                    <div class="sub-desc"><strong>Invertebrata:</strong> Tidak bertulang belakang.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/siput2.jpeg' %}"><div class="gallery-caption">Siput</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Kupu.jpg' %}"><div class="gallery-caption">Kupu-kupu</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Bintang.webp' %}"><div class="gallery-caption">Bintang Laut</div></div>
                    </div>
                </div>
                <div id="animalia-vert" class="content-sect" style="display:none;">
                    <div class="sub-desc"><strong>Vertebrata:</strong> Bertulang belakang.</div>
                    <div class="gallery-grid">
                        <div class="gallery-item"><img src="{% static 'img/kucing.jpeg' %}"><div class="gallery-caption">Kucing</div></div>
                        <div class="gallery-item"><img src="{% static 'img/ikan2.jpeg' %}"><div class="gallery-caption">Ikan Mas</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Elang.jpg' %}"><div class="gallery-caption">Elang</div></div>
                        <div class="gallery-item"><img src="{% static 'img/Katak.jpg' %}"><div class="gallery-caption">Katak</div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-3"></div>
            <button id="btn-next-3" class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)" disabled>
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-4" class="learning-slide">
    <div class="learning-card">
        <h3 class="title-highlight text-center">Analisis Struktur</h3>
        <p class="text-content text-center mb-4">
            Klik tombol analisis di bawah untuk melihat perbedaan struktural secara detail.
        </p>

        <div class="mt-4 mb-5 border-bottom pb-5">
            <h5 class="font-weight-bold text-primary mb-3"><i class="fas fa-microscope mr-2"></i>Kasus 1: Tumbuhan vs Jamur</h5>
            <div class="inspector-wrapper" id="inspect-1">
                <div class="inspector-group">
                    <div class="inspector-card"><img src="{% static 'img/plantae.jpg' %}" alt="Tumbuhan"></div>
                    <div class="inspector-info info-green" id="info-plant"><h6 class="font-weight-bold mb-1">TUMBUHAN</h6><p class="mb-0 info-text">...</p></div>
                </div>
                <div class="inspector-group">
                    <div class="inspector-card"><img src="{% static 'img/jamur4.jpg' %}" alt="Jamur"></div>
                    <div class="inspector-info info-orange" id="info-fungi"><h6 class="font-weight-bold mb-1">JAMUR</h6><p class="mb-0 info-text">...</p></div>
                </div>
            </div>
            <div class="inspector-controls">
                <button class="btn-inspect" onclick="analyzeTrait('1', 'klorofil', 'Punya Klorofil (Autotrof).', 'Tidak Punya Klorofil (Heterotrof).', this)">Cek Klorofil</button>
                <button class="btn-inspect" onclick="analyzeTrait('1', 'dinding', 'Dinding sel: Selulosa.', 'Dinding sel: Kitin.', this)">Cek Dinding Sel</button>
                <button class="btn-inspect" onclick="analyzeTrait('1', 'makan', 'Membuat makanan sendiri (Fotosintesis).', 'Menyerap zat organik dari lingkungan (Saprofit).', this)">Cara Makan</button>
            </div>
        </div>

        <div class="mt-4">
            <h5 class="font-weight-bold text-primary mb-3"><i class="fas fa-fish mr-2"></i>Kasus 2: Vertebrata vs Invertebrata</h5>
            <div class="inspector-wrapper" id="inspect-2">
                <div class="inspector-group">
                    <div class="inspector-card"><img src="{% static 'img/kelabau.jpeg' %}" alt="Ikan"></div>
                    <div class="inspector-info info-blue" id="info-vert"><h6 class="font-weight-bold mb-1">VERTEBRATA</h6><p class="mb-0 info-text">...</p></div>
                </div>
                <div class="inspector-group">
                    <div class="inspector-card"><img src="{% static 'img/siput4.jpg' %}" alt="Siput"></div>
                    <div class="inspector-info info-red" id="info-inv"><h6 class="font-weight-bold mb-1">INVERTEBRATA</h6><p class="mb-0 info-text">...</p></div>
                </div>
            </div>
            <div class="inspector-controls">
                <button class="btn-inspect" onclick="analyzeTrait('2', 'tulang', 'Punya tulang belakang.', 'Tidak punya tulang belakang.', this)">Cek Tulang</button>
                <button class="btn-inspect" onclick="analyzeTrait('2', 'saraf', 'Sistem saraf pusat (Otak & Sumsum).', 'Sistem saraf sederhana (Tangga tali/Difus).', this)">Sistem Saraf</button>
            </div>
        </div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-4"></div>
            <button id="btn-next-4" class="btn btn-outline-primary btn-nav-page" onclick="changePage(1)" disabled>
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

<div id="slide-5" class="learning-slide">
    <div class="learning-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h3 class="title-highlight mb-0">Game Klasifikasi</h3>
                <small class="text-muted">Masukkan spesies ke Rak Kingdom yang tepat!</small>
            </div>
            <span class="badge badge-success p-2">Skor: <span id="score">0</span>/10</span>
        </div>

        <div class="game-area">
            <div class="bucket-container">
                <div class="bucket" data-kingdom="monera" style="border-bottom: 3px solid #e74a3b;">
                    <i class="fas fa-bacterium bucket-icon text-danger"></i><span class="bucket-name text-danger">Monera</span>
                    <div class="bucket-content"></div> 
                </div>
                <div class="bucket" data-kingdom="protista" style="border-bottom: 3px solid #36b9cc;">
                    <i class="fas fa-question-circle bucket-icon text-info"></i><span class="bucket-name text-info">Protista</span>
                    <div class="bucket-content"></div>
                </div>
                <div class="bucket" data-kingdom="fungi" style="border-bottom: 3px solid #f6c23e;">
                    <i class="fas fa-bread-slice bucket-icon text-warning"></i><span class="bucket-name text-warning">Fungi</span>
                    <div class="bucket-content"></div>
                </div>
                <div class="bucket" data-kingdom="plantae" style="border-bottom: 3px solid #1cc88a;">
                    <i class="fas fa-leaf bucket-icon text-success"></i><span class="bucket-name text-success">Plantae</span>
                    <div class="bucket-content"></div>
                </div>
                <div class="bucket" data-kingdom="animalia" style="border-bottom: 3px solid #4e73df;">
                    <i class="fas fa-paw bucket-icon text-primary"></i><span class="bucket-name text-primary">Animalia</span>
                    <div class="bucket-content"></div>
                </div>
            </div>

            <p class="text-center small mb-1">Tarik gambar di bawah ini:</p>
            <div class="pool-container" id="pool-container">
                <small class="text-muted font-italic w-100 text-center mb-2" id="pool-hint">-- Area Barang --</small>
            </div>
        </div>

        <div id="game-toast">Kurang tepat! Coba lagi.</div>

        <div class="pagination-footer">
            <button class="btn btn-outline-secondary btn-nav-page" onclick="changePage(-1)">
                <i class="fas fa-chevron-left"></i> Kembali
            </button>
            <div class="page-numbers-container" id="page-numbers-5"></div>
            
            <a id="btn-finish-module" href="{% url 'latihan_soal' 3 %}" class="btn btn-success btn-nav-page" style="display: none;">
                Selesai <i class="fas fa-check"></i>
            </a>
        </div>
    </div>
</div>

{% endblock %}

{% block custom_js %}
<script>
// === 1. GLOBAL STATE & NAVIGATION ===
const stepNames = ["Stimulasi", "Identifikasi", "Ensiklopedia", "Analisis", "Permainan"];
const totalSlides = 5;
let currentSlideIndex = 1;

// Initial State (1 Unlocked, rest Locked)
let progressState = {
    1: true,
    2: false, 
    3: false,
    4: false,
    5: false
};

// --- Storage Logic ---
function loadProgress() {
    const saved = localStorage.getItem('modul_3_progress');
    if (saved) {
        progressState = JSON.parse(saved);
        // Smart Unlock: Jika level atas terbuka, level bawah otomatis terbuka
        if (progressState[5]) { progressState[4] = true; }
        if (progressState[4]) { progressState[3] = true; }
        if (progressState[3]) { progressState[2] = true; }
        if (progressState[2]) { progressState[1] = true; }
    }
}

function saveProgress() {
    localStorage.setItem('modul_3_progress', JSON.stringify(progressState));
}

// --- Navigation Logic ---
function nextSlide(n) {
    if (n > currentSlideIndex) {
        if (currentSlideIndex === 2 && !progressState[3]) {
             if(document.getElementById('btn-next-2').disabled) {
                 alert("Silakan balik semua kartu kuis terlebih dahulu!");
                 return;
             }
        }
        if (currentSlideIndex === 3 && !progressState[4]) {
             if(document.getElementById('btn-next-3').disabled) {
                 alert("Silakan buka kelima tab Kingdom terlebih dahulu!");
                 return;
             }
        }
        if (currentSlideIndex === 4 && !progressState[5]) {
             if(document.getElementById('btn-next-4').disabled) {
                 alert("Lakukan analisis pada kedua kasus terlebih dahulu!");
                 return;
             }
        }
    }

    document.querySelectorAll('.learning-slide').forEach(el => {
        el.classList.remove('active');
        el.style.opacity = 0;
    });
    
    const target = document.getElementById('slide-' + n);
    if(target) {
        target.classList.add('active');
        setTimeout(() => target.style.opacity = 1, 50);
        
        document.querySelector('.modul-header-card').scrollIntoView({behavior: 'smooth'});
        if(stepNames[n-1]) document.getElementById('step-badge').innerText = stepNames[n-1];

        currentSlideIndex = n;
        
        // Auto Unlock on Arrival
        if (n > 1) {
            for(let k=1; k < n; k++) {
                progressState[k+1] = true; 
            }
            saveProgress();
        }

        renderPageNumbers(n);
        checkNextButtonState(n);

        // Slide Specific Init
        if (n === 3) markTabRead('monera'); // Auto mark first tab
        if(n === 5 && document.getElementById('pool-container').children.length <= 1) initGame();
    }
}

function changePage(offset) {
    const targetPage = currentSlideIndex + offset;
    if (targetPage < 1 || targetPage > totalSlides) return;
    nextSlide(targetPage);
}

function renderPageNumbers(slideNum) {
    const container = document.getElementById(`page-numbers-${slideNum}`);
    if(!container) return;

    let html = '';
    for(let i=1; i<=totalSlides; i++) {
        let btnClass = 'btn-page-number';
        let disabledAttr = 'disabled';
        let onClickAttr = '';

        if (i === slideNum) {
            btnClass += ' active'; 
            disabledAttr = ''; 
        } else if (i < slideNum || progressState[i+1] === true || (i===1)) { 
            btnClass += ' unlocked'; 
            disabledAttr = '';
            onClickAttr = `onclick="nextSlide(${i})"`;
        }

        html += `<button class="${btnClass}" ${disabledAttr} ${onClickAttr}>${i}</button>`;
    }
    container.innerHTML = html;
}

function checkNextButtonState(n) {
    if (n === 1) {
        // Slide 1 always allows going to 2
        document.getElementById('btn-next-1').removeAttribute('disabled');
    }
    if (n === 2) {
        const btn = document.getElementById('btn-next-2');
        if (progressState[3]) btn.removeAttribute('disabled');
        else btn.setAttribute('disabled', 'true');
    }
    if (n === 3) {
        const btn = document.getElementById('btn-next-3');
        if (progressState[4]) btn.removeAttribute('disabled');
        else btn.setAttribute('disabled', 'true');
    }
    if (n === 4) {
        const btn = document.getElementById('btn-next-4');
        if (progressState[5]) btn.removeAttribute('disabled');
        else btn.setAttribute('disabled', 'true');
    }
    if (n === 5) {
        const btn = document.getElementById('btn-finish-module');
        // Game finish logic handled in game function
        if (score === 10) btn.style.display = 'inline-block';
    }
}

// === 2. SLIDE 2 LOGIC (FLIP CARD) ===
let flippedCount = 0;
let flippedCards = new Set();

function flipCard(card, id) {
    if (!card.classList.contains('flipped')) {
        card.classList.add('flipped');
        flippedCards.add(id);
        
        if (flippedCards.size === 3) {
            progressState[3] = true; // Unlock slide 3
            saveProgress();
            document.getElementById('btn-next-2').removeAttribute('disabled');
            renderPageNumbers(2);
        }
    } else {
        card.classList.remove('flipped');
    }
}

// === 3. SLIDE 3 LOGIC (ENSIKLOPEDIA) ===
let visitedTabs = new Set();
const totalTabs = 5;

function trackTab(kingdom) {
    // Show Sub Content Logic (Reset sub tabs)
    resetSub(kingdom);
    
    // Add mark
    markTabRead(kingdom);
}

function markTabRead(kingdom) {
    visitedTabs.add(kingdom);
    const link = document.getElementById(`tab-btn-${kingdom}`);
    if(link && !link.classList.contains('read-mark')) {
        link.classList.add('read-mark');
    }

    if (visitedTabs.size === totalTabs) {
        progressState[4] = true; // Unlock slide 4
        saveProgress();
        document.getElementById('btn-next-3').removeAttribute('disabled');
        renderPageNumbers(3);
    }
}

function showContent(kingdom, sub, btn) {
    document.querySelectorAll(`#tab-${kingdom} .content-sect`).forEach(el => el.style.display = 'none');
    const target = document.getElementById(`${kingdom}-${sub}`);
    if(target) {
        target.style.display = 'block';
        target.style.animation = "fadeIn 0.5s";
    }
    const btns = btn.parentElement.querySelectorAll('.btn-sub');
    btns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function resetSub(kingdom) {
    setTimeout(() => {
        const firstBtn = document.querySelector(`#tab-${kingdom} .sub-filter-container .btn-sub`);
        if(firstBtn) firstBtn.click();
    }, 100);
}

// === 4. SLIDE 4 LOGIC (INSPECTOR) ===
let analyzedCases = new Set();

function analyzeTrait(caseId, trait, textLeft, textRight, btn) {
    let infoLeft, infoRight;
    if(caseId === '1') {
        infoLeft = document.getElementById('info-plant');
        infoRight = document.getElementById('info-fungi');
    } else {
        infoLeft = document.getElementById('info-vert');
        infoRight = document.getElementById('info-inv');
    }
    
    btn.parentElement.querySelectorAll('.btn-inspect').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    infoLeft.style.display = 'block';
    infoRight.style.display = 'block';
    infoLeft.querySelector('.info-text').innerText = textLeft;
    infoRight.querySelector('.info-text').innerText = textRight;

    analyzedCases.add(caseId);
    if(analyzedCases.size === 2) {
        progressState[5] = true; // Unlock slide 5
        saveProgress();
        document.getElementById('btn-next-4').removeAttribute('disabled');
        renderPageNumbers(4);
    }
}

// === 5. SLIDE 5 LOGIC (GAME) ===
const gameData = [
    {id:'g1', name:'E. coli', kingdom:'monera', img:"{% static 'img/bakteriecoli.jpeg' %}", info:'Monera: Prokariotik.'},
    {id:'g2', name:'Paramecium', kingdom:'protista', img:"{% static 'img/paramecium.jpg' %}", info:'Protista: Mirip hewan.'},
    {id:'g3', name:'Jamur Roti', kingdom:'fungi', img:"{% static 'img/jamurroti.jpg' %}", info:'Fungi: Zygomycota.'},
    {id:'g4', name:'Lumut', kingdom:'plantae', img:"{% static 'img/lumut.jpeg' %}", info:'Plantae: Bryophyta.'},
    {id:'g5', name:'Kucing', kingdom:'animalia', img:"{% static 'img/kucing.jpeg' %}", info:'Animalia: Mamalia.'},
    {id:'g6', name:'Lactobacillus', kingdom:'monera', img:"{% static 'img/Lactobacillus.jpg' %}", info:'Monera: Bakteri susu.'},
    {id:'g7', name:'Amoeba', kingdom:'protista', img:"{% static 'img/Amoeba.jpeg' %}", info:'Protista: Kaki semu.'},
    {id:'g8', name:'Jamur Tiram', kingdom:'fungi', img:"{% static 'img/jamurtiram.jpg' %}", info:'Fungi: Basidiomycota.'},
    {id:'g9', name:'Jagung', kingdom:'plantae', img:"{% static 'img/jagung3.jpg' %}", info:'Plantae: Monokotil.'},
    {id:'g10', name:'Siput', kingdom:'animalia', img:"{% static 'img/siput2.jpeg' %}", info:'Animalia: Mollusca.'}
];
let score = 0;

function initGame() {
    const pool = document.getElementById('pool-container');
    Array.from(pool.children).forEach(child => { if(child.id !== 'pool-hint') child.remove(); });
    gameData.sort(() => Math.random() - 0.5);
    gameData.forEach(d => {
        let el = document.createElement('div');
        el.className = 'drag-item';
        el.draggable = true;
        el.id = d.id;
        el.dataset.kingdom = d.kingdom;
        el.innerHTML = `<img src="${d.img}" style="pointer-events:none;"><div class="drag-label" style="font-size:0.8rem; padding: 5px 0;">${d.name}</div>`;
        el.addEventListener('dragstart', dragStart);
        pool.appendChild(el);
    });
    document.querySelectorAll('.bucket').forEach(b => {
        b.addEventListener('dragover', dragOver);
        b.addEventListener('dragleave', dragLeave);
        b.addEventListener('drop', drop);
    });
}
function dragStart(e) { e.dataTransfer.setData('text', e.target.id); setTimeout(()=>e.target.style.visibility='hidden', 0); }
function dragOver(e) { e.preventDefault(); e.currentTarget.classList.add('hover'); }
function dragLeave(e) { e.currentTarget.classList.remove('hover'); }
function drop(e) {
    e.preventDefault();
    const bucket = e.currentTarget;
    bucket.classList.remove('hover');
    const id = e.dataTransfer.getData('text');
    const item = document.getElementById(id);
    
    if(item.dataset.kingdom === bucket.dataset.kingdom) {
        const data = gameData.find(x => x.id === item.id);
        const card = document.createElement('div');
        card.className = 'bucket-card';
        card.innerHTML = `<img src="${data.img}"><div><strong>${data.name}</strong><br><span class="text-muted">${data.info}</span></div>`;
        bucket.querySelector('.bucket-content').appendChild(card);
        item.remove();
        score++;
        document.getElementById('score').innerText = score;
        if(score === 10) {
            document.getElementById('pool-hint').innerText = "Selesai!";
            document.getElementById('btn-finish-module').style.display = 'inline-block';
        }
    } else {
        item.style.visibility = 'visible';
        item.classList.add('shake-anim');
        showToast();
        setTimeout(() => { item.classList.remove('shake-anim'); }, 500);
    }
}

function showToast() {
    const toast = document.getElementById("game-toast");
    toast.className = "show";
    setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 2500);
}

// === INIT ===
document.addEventListener('DOMContentLoaded', () => {
    loadProgress(); 
    checkNextButtonState(1);
    renderPageNumbers(1);
});
</script>
{% endblock %}