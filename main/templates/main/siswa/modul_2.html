{% extends 'main/base.html' %}
{% load static %}
{% block title %}Modul 2: {{ subbab.judul }}{% endblock %}
{% block custom_css %}
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap');
    body {
        font-family: 'Nunito', sans-serif;
        background: #f3f6fd;
    }
    .modul-header-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.6rem;
        background: #fff;
        padding: 1.1rem 1.5rem;
        border-radius: 1.2rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    }
    .modul-header-title {
        font-family: 'Nunito', sans-serif;
        color: #22356f;
        font-weight: 900;
        font-size: 1.28rem;
        margin-bottom: 3px;
    }
    .modul-header-keterangan {
        font-size: 0.92rem;
        color: #7a849c;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    .learning-slide { display: none; }
    .learning-slide.active { display: block; }
    .learning-card {
        background: #fff;
        border-radius: 2.2rem;
        box-shadow: 0 8px 32px rgba(53,99,233,0.10);
        padding: 2.6rem 5vw 2.2rem 5vw;
        width: 100%;
        max-width: 100%;
        margin: 0 auto 2.5rem auto;
    }
    @media (max-width: 900px) {
        .learning-card { padding: 1.0rem .7rem 1.0rem .7rem; border-radius: 1.08rem; }
        .modul-header-card { padding: 0.7rem;}
        .modul-header-title { font-size: 1.12rem;}
    }
    .learning-card .card-header {
        background: transparent;
        border: none;
        border-radius: 2.2rem 2.2rem 0 0;
        font-weight: 800;
        padding: 0;
        margin-bottom: 1.02rem;
    }
    .learning-card .card-header h6 {
        color: #246bfd;
        font-size: 1.13rem;
        font-weight: 900;
        font-family: 'Nunito', sans-serif !important;
        margin-bottom: 0;
        line-height: 1.22;
        letter-spacing: .007em;
    }
    .learning-card .card-body h5, .learning-card .card-body h4 {
        font-family: 'Nunito', sans-serif !important;
        color: #1c253b;
        font-size: 1.19rem;
        font-weight: 800;
        margin-bottom: .58rem;
    }
    .learning-card ul, .learning-card ol {
        margin-left: 1.11rem;
        margin-bottom: 1rem;
        color: #495466;
    }
    .learning-card button.btn-primary {
        background-color: #246bfd;
        font-weight: 700;
        border-radius: 0.85rem;
        border: none;
    }
    .learning-card button.btn-primary:hover,
    .learning-card button.btn-primary:focus {
        background-color: #1c519b;
    }
    .learning-card button.btn-secondary { border-radius: 0.85rem; }

    /* Gaya untuk Kunci Dikotom TERTULIS (dari PDF) */
    .kunci-determinasi {
        padding-left: 0;
        list-style-type: none;
    }
    .kunci-determinasi li {
        margin-bottom: 8px; /* Jarak antar baris diperlebar sedikit */
        padding-left: 20px;
    }
    .kunci-determinasi li strong {
        color: #333;
        margin-right: 5px;
    }
    .kunci-determinasi li span {
        font-style: normal; /* Agar lebih mudah dibaca */
        color: #fff;
        background-color: #4e73df;
        padding: 2px 8px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.9em;
        margin-left: 5px;
    }
    /* Warna khusus untuk hasil akhir (nama organisme) */
    .kunci-determinasi li span.hasil-akhir {
        background-color: #1cc88a; /* Hijau */
    }
    
    /* === GAYA BARU UNTUK PIRAMIDA & KOTAK INFO (SLIDE 5) === */
    .piramida { display: flex; flex-direction: column; align-items: center; }
    .level-takson {
        background-color: #4e73df; color: white; margin: 2px 0;
        padding: 10px; border-radius: 5px; cursor: pointer;
        transition: background-color 0.2s;
        font-weight: 700;
        font-style: italic; /* Membuat teks latin miring */
    }
    .level-takson:hover { background-color: #2e59d9; }
    #kingdom { width: 100%; }
    #filum { width: 90%; }
    #kelas { width: 80%; }
    #ordo { width: 70%; }
    #famili { width: 60%; }
    #genus { width: 50%; }
    #spesies { width: 40%; }
    
    #takson-info-box {
        display: none; /* Sembunyi awalnya */
        background: #f8f9fc;
        border: 1px solid #e3e6f0;
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 1.5rem;
    }
    #takson-info-box h5 {
        font-weight: 800;
        color: #246bfd;
        margin-bottom: 0.75rem;
        font-style: italic; /* Judul (Latin) miring */
    }
    #takson-info-box p {
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
        color: #1c253b;
    }
    #takson-info-box p strong {
        display: inline-block;
        width: 150px; /* Ratakan label */
        font-style: normal;
    }
    
    /* Gaya untuk Kunci Hirarki (Materi Singkat) */
    .kunci-hirarki {
        list-style-type: none;
        padding-left: 0;
    }
    .kunci-hirarki li {
        position: relative;
        padding-left: 30px;
        margin-top: 10px;
    }
    .kunci-hirarki li::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        border-left: 1px dashed #4e73df;
        border-bottom: 1px dashed #4e73df;
        width: 20px;
        height: 20px;
    }
    .kunci-hirarki li::after {
        content: '';
        position: absolute;
        left: 0;
        top: 20px;
        border-left: 1px dashed #4e73df;
        height: 100%;
    }
    .kunci-hirarki li:last-child::after { display: none; }
    .kunci-hirarki li strong { color: #4e73df; }
    .kunci-hirarki li span {
        background-color: #1cc88a;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-weight: bold;
    }
    /* === AKHIR GAYA BARU === */

    </style>
{% endblock %}

{% block content %}
<div class="modul-header-card">
    <div>
        <div class="modul-header-title">Modul 2: {{ subbab.judul }}</div>
        <div class="modul-header-keterangan">
            {{ subbab.deskripsi|default:"Kerjakan materi berikut dengan sungguh-sungguh dan catat hal penting." }}
        </div>
    </div>
</div>

    <div id="slide-1" class="learning-slide active">
        <div class="learning-card">
            <div class="card-header">
                <h6>Tujuan Pembelajaran (Stimulasi)</h6>
            </div>
            <div class="card-body">
                <p>Setelah mengikuti kegiatan pembelajaran ini, kamu diharapkan dapat:</p>
                <ol>
                    <li>Menjelaskan tujuan dan dasar klasifikasi makhluk hidup.</li>
                    <li>Menjelaskan apa itu kunci dikotom.</li>
                    <li>Menggunakan kunci dikotom sederhana untuk mengidentifikasi organisme.</li>
                    <li>Menjelaskan urutan takson dalam klasifikasi.</li>
                </ol>
                <button class="btn btn-primary" onclick="showSlide(2)">
                    Mulai Belajar <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="slide-2" class="learning-slide">
        <div class="learning-card">
            <div class="card-header">
                <h6>Materi Pembelajaran Singkat</h6>
            </div>
            <div class="card-body">
                <h5 class="text-gray-900">1. Pengertian Klasifikasi Makhluk Hidup</h5>
                <p>Klasifikasi adalah pengelompokan makhluk hidup berdasarkan persamaan dan perbedaan cirinya.</p>
                <p>Tujuan klasifikasi adalah:</p>
                <ul>
                    <li>Mempermudah mengenali dan mempelajari makhluk hidup.</li>
                    <li>Mengetahui hubungan kekerabatannya antar makhluk hidup.</li>
                    <li>Mengelompokkan makhluk hidup ke dalam kategori tertentu (jenis, genus, famili, dan seterusnya).</li>
                </ul>

                <h5 class="text-gray-900 mt-4">2. Dasar Klasifikasi Makhluk Hidup</h5>
                <p>Makhluk hidup diklasifikasikan berdasarkan beberapa dasar pengelompokan, antara lain:</p>
                <ol>
                    <li>Bentuk tubuh dan struktur organ.</li>
                    <li>Jenis makanan dan cara mendapatkan makanan.</li>
                    <li>Habitat atau tempat hidupnya.</li>
                    <li>Cara berkembang biak.</li>
                    <li>Persamaan ciri morfologi dan fisiologi.</li>
                </ol>

                <h5 class="text-gray-900 mt-4">3. Kunci Dikotom</h5>
                <p>
                    Kunci dikotom adalah alat bantu untuk mengidentifikasi makhluk hidup berdasarkan dua pilihan ciri yang saling bertentangan (dua cabang).
                </p>
                <p class="mt-2">
                    <strong>Contoh Penggunaan Kunci Dikotom (Bagan):</strong>
                </p>
                <ul class="kunci-hirarki">
                    <li>
                        <strong>(1) Apakah tumbuhan berspora?</strong>
                        <ul>
                            <li>
                                <strong>YA (1a):</strong>
                                <ul>
                                    <li>
                                        <strong>(2a) Berbatang jelas:</strong> <span>Suplir</span>
                                    </li>
                                    <li>
                                        <strong>(2b) Tidak berbatang jelas:</strong> <span>Lumut</span>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <strong>TIDAK (1b):</strong>
                                <ul>
                                    <li>
                                        <strong>(3a) Berbiji tertutup:</strong>
                                        <ul>
                                            <li>
                                                <strong>(4a) Biji keping dua:</strong> <span>Mawar</span>
                                            </li>
                                            <li>
                                                <strong>(4b) Biji keping satu:</strong> <span>Jagung</span>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <strong>(3b) Berbiji terbuka:</strong> <span>Melinjo</span>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
                <hr>
                <button class="btn btn-secondary" onclick="showSlide(1)">
                    <i class="fas fa-arrow-left"></i> Kembali
                </button>
                <button class="btn btn-primary" onclick="showSlide(3)">
                    Lanjut ke Aktivitas <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="slide-3" class="learning-slide">
        <div class="learning-card">
            <div class="card-header">
                <h6>Aktivitas 1: Penyelidikan Kunci Identitas</h6>
            </div>
            <div class="card-body">
                <p>
                    Mari kita selidiki. Coba gunakan pemandu interaktif ini untuk mengidentifikasi 5 organisme. Amati ciri-cirinya dan kumpulkan datanya untuk menemukan identitas mereka!
                </p>
                <div id="pemandu-area"></div>
                <hr>
                <button class="btn btn-secondary" onclick="showSlide(2)">
                    <i class="fas fa-arrow-left"></i> Kembali ke Materi
                </button>
                <button id="btn-ke-slide-4"
                        class="btn btn-primary"
                        onclick="showSlide(4)"
                        style="display:none">
                    Apa yang baru saja kita lakukan? <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="slide-4" class="learning-slide">
        <div class="learning-card">
            <div class="card-header">
                <h6>Kesimpulan: Konsep Klasifikasi & Kunci Dikotom</h6>
            </div>
            <div class="card-body">
                <h5 class="text-gray-900">1. Hakekat Klasifikasi Makhluk Hidup</h5>
                <p>
                    Aktivitas yang telah kamu lakukan adalah simulasi dari proses <strong>Klasifikasi</strong>. 
                    Klasifikasi bukan hanya sekadar mengelompokkan, tetapi merupakan proses sistematis untuk memisahkan makhluk hidup berdasarkan 
                    <strong>persamaan ciri</strong> yang umum hingga ke ciri yang paling khusus.
                </p>
                <p>
                    Dasar utamanya adalah <strong>Morfologi</strong> (bentuk luar tubuh, seperti bentuk daun atau paruh) dan 
                    <strong>Anatomi</strong> (struktur dalam tubuh).
                </p>

                <h5 class="text-gray-900 mt-4">2. Tujuan Klasifikasi</h5>
                <ul style="color: #495466;">
                    <li><strong>Mempermudah Studi:</strong> Membuat keanekaragaman hayati yang sangat banyak menjadi lebih mudah dipelajari.</li>
                    <li><strong>Mengetahui Hubungan Kekerabatan:</strong> Mengetahui seberapa dekat hubungan antara satu organisme dengan organisme lainnya.</li>
                    <li><strong>Pemberian Nama (Nomenklatur):</strong> Memberikan nama ilmiah yang diakui secara universal.</li>
                </ul>

                <h5 class="text-gray-900 mt-4">3. Prinsip Kunci Dikotom</h5>
                <p>
                    Alat bantu yang kamu gunakan tadi disebut <strong>Kunci Dikotom</strong>. Prinsip kerjanya adalah:
                </p>
                <ul>
                    <li>Selalu terdiri dari <strong>dua pernyataan yang berlawanan</strong>.</li>
                    <li>Setiap pilihan akan membawamu ke langkah berikutnya yang lebih spesifik hingga nama organisme ditemukan.</li>
                </ul>

                <hr>
                <h5 class="text-gray-900 mt-4">4. Hasil Identifikasi (Kunci Determinasi)</h5>
                <p>
                    Berdasarkan aktivitasmu, berikut adalah contoh <strong>Kunci Determinasi</strong> yang disusun dengan bahasa yang lebih sederhana:
                </p>
                
                <ul class="kunci-determinasi">
                    <li>
                        <strong>1. a.</strong> Tumbuhan yang berspora ..... <span>Periksa ciri pada nomor 2</span>
                    </li>
                    <li>
                        <strong>1. b.</strong> Tumbuhan yang tidak berspora ..... <span>Periksa ciri pada nomor 3</span>
                    </li>
                    <li>
                        <strong>2. a.</strong> Tumbuhan yang berbatang jelas ..... <span class="hasil-akhir">Suplir (Pteridophyta)</span>
                    </li>
                    <li>
                        <strong>2. b.</strong> Tumbuhan yang tidak berbatang jelas ..... <span class="hasil-akhir">Lumut (Bryophyta)</span>
                    </li>
                    <li>
                        <strong>3. a.</strong> Berbiji tertutup (Angiospermae) ..... <span>Periksa ciri pada nomor 4</span>
                    </li>
                    <li>
                        <strong>3. b.</strong> Berbiji terbuka (Gymnospermae) ..... <span class="hasil-akhir">Melinjo</span>
                    </li>
                    <li>
                        <strong>4. a.</strong> Biji berkeping dua ..... <span class="hasil-akhir">Mawar (Dikotil)</span>
                    </li>
                    <li>
                        <strong>4. b.</strong> Biji berkeping satu ..... <span class="hasil-akhir">Jagung (Monokotil)</span>
                    </li>
                </ul>
                
                <hr>
                <button class="btn btn-secondary" onclick="showSlide(3)">
                    <i class="fas fa-arrow-left"></i> Kembali
                </button>
                <button class="btn btn-primary" onclick="showSlide(5)">
                    Bagaimana Itu disusun? <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="slide-5" class="learning-slide">
        <div class="learning-card">
            <div class="card-header">
                <h6>Aktivitas 2: "Lemari" Klasifikasi (Takson)</h6>
            </div>
            <div class="card-body">
                <p>
                    Ini adalah 7 tingkatan utama (Takson). <strong>Klik setiap level</strong> pada piramida di bawah untuk "menemukan" dan mempelajari istilah Bahasa Indonesia dan Inggrisnya.
                </p>
                <p>Urutan ini didasarkan atas persamaan ciri. Makin ke bawah, persamaan ciri semakin banyak.</p>
                <div class="piramida text-center mt-4">
                    <div id="kingdom" class="level-takson" onclick="showTaksonInfo('kingdom')">Regnum</div>
                    <div id="filum" class="level-takson" onclick="showTaksonInfo('filum')">Divisio/Phyllum</div>
                    <div id="kelas" class="level-takson" onclick="showTaksonInfo('kelas')">Classis</div>
                    <div id="ordo" class="level-takson" onclick="showTaksonInfo('ordo')">Ordo</div>
                    <div id="famili" class="level-takson" onclick="showTaksonInfo('famili')">Familia</div>
                    <div id="genus" class="level-takson" onclick="showTaksonInfo('genus')">Genus</div>
                    <div id="spesies" class="level-takson" onclick="showTaksonInfo('spesies')">Species</div>
                </div>
                <div id="takson-info-box">
                    <h5 id="takson-info-title">Silakan klik salah satu level di atas.</h5>
                    <p id="takson-info-indo">
                        <strong>Bahasa Indonesia:</strong> -
                    </p>
                    <p id="takson-info-eng">
                        <strong>Bahasa Inggris:</strong> -
                    </p>
                </div>
                <hr>
                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-secondary mr-2" onclick="showSlide(4)">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </button>
                    <a id="finish-modul-2-btn"
                       href="{% url 'selesai_step' 'modul_2' %}"
                       class="btn btn-success btn-icon-split"
                       style="display:none">
                        <span class="icon text-white-70"><i class="fas fa-check"></i></span>
                        <span class="text">Selesai Modul 2 & Buka Latihan Soal</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block custom_js %}
    <script>
    // --- FUNGSI GLOBAL ---
    
    let currentSlide = 1;
    function showSlide(slideNumber) {
        const activeSlide = document.querySelector('.learning-slide.active');
        if (activeSlide) {
            activeSlide.classList.remove('active');
        }
        const nextSlide = document.getElementById('slide-' + slideNumber);
        if (nextSlide) {
            currentSlide = slideNumber;
            nextSlide.classList.add('active');
        } else {
            console.error("Slide " + slideNumber + " tidak ditemukan!");
        }
    }

    // --- LOGIKA BARU UNTUK PIRAMIDA INTERAKTIF (SLIDE 5) ---
    
    const taksonData = {
        'kingdom': { indo: 'Dunia', latin: 'Regnum', inggris: 'Kingdom' },
        'filum': { indo: 'Divisi/Filum', latin: 'Divisio/Phyllum', inggris: 'Division/Phyllum' },
        'kelas': { indo: 'Kelas', latin: 'Classis', inggris: 'Class' },
        'ordo': { indo: 'Bangsa', latin: 'Ordo', inggris: 'Order' },
        'famili': { indo: 'Suku', latin: 'Familia', inggris: 'Family' },
        'genus': { indo: 'Marga', latin: 'Genus', inggris: 'Genus' },
        'spesies': { indo: 'Jenis', latin: 'Species', inggris: 'Species' }
    };

    let taksonDilihat = new Set();
    
    // FUNGSI INI TELAH DIUBAH
    function showTaksonInfo(levelName) {
        const data = taksonData[levelName];
        
        // Ambil elemen info box
        const infoBox = document.getElementById('takson-info-box');
        const infoTitle = document.getElementById('takson-info-title');
        const infoIndo = document.getElementById('takson-info-indo');
        const infoEng = document.getElementById('takson-info-eng');

        // Isi data ke info box (SESUAI PERMINTAAN BARU)
        infoTitle.innerText = data.latin; // Judul sekarang Latin
        infoIndo.innerHTML = `<strong>Bahasa Indonesia:</strong> ${data.indo}`;
        infoEng.innerHTML = `<strong>Bahasa Inggris:</strong> ${data.inggris}`;
        
        // Tampilkan info box
        infoBox.style.display = 'block';
        
        // Lacak kartu yang sudah diklik
        taksonDilihat.add(levelName);
        
        const btnSelesaiModul = document.getElementById('finish-modul-2-btn');
        
        // Tampilkan tombol selesai jika siswa sudah klik minimal 4 level
        if (taksonDilihat.size >= 4 && btnSelesaiModul) {
            btnSelesaiModul.style.display = 'inline-block';
        }
    }
    
    // --- KODE INISIALISASI (HANYA UNTUK SLIDE 3 - AKTIVITAS 1) ---
    
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Setup untuk Slide 3 (Pemandu Identifikasi) ---
        let organismeAktif = null; 
        const pemanduArea = document.getElementById('pemandu-area');
        const btnKeSlide4 = document.getElementById('btn-ke-slide-4'); // ID baru (ke slide 4)
        
        // Pengecekan penting
        if (!pemanduArea) {
             return; 
        }

        const totalOrganisme = 5; 
        let organismeSudahBenar = new Set(); 

        const kunci = {
            'start': {
                teks: "Pilih organisme yang ingin kamu buktikan identitasnya:",
                pilihan: [
                    { teks: "Lumut", img: "{% static 'img/lumut.jpeg' %}", next: "kunci_1" },
                    { teks: "Suplir", img: "{% static 'img/suplir.jpeg' %}", next: "kunci_1" },
                    { teks: "Jagung", img: "{% static 'img/jagung.jpeg' %}", next: "kunci_1" },
                    { teks: "Mawar", img: "{% static 'img/mawar.jpeg' %}", next: "kunci_1" },
                    { teks: "Melinjo", img: "{% static 'img/melinjo.jpeg' %}", next: "kunci_1" }
                ],
                isStart: true
            },
            'kunci_1': {
                teks: "1. Apakah tumbuhan ini berspora?",
                pilihan: [
                    { teks: "YA, Berspora (1a)", next: "kunci_2" },
                    { teks: "TIDAK, Tidak berspora (1b)", next: "kunci_3" }
                ]
            },
            'kunci_2': {
                teks: "2. Apakah memiliki batang yang jelas?",
                pilihan: [
                    { teks: "YA, Batang Jelas (2a)", next: "hasil_suplir" },
                    { teks: "TIDAK, Batang Tidak Jelas (2b)", next: "hasil_lumut" }
                ]
            },
            'kunci_3': {
                teks: "3. Apakah bijinya tertutup?",
                pilihan: [
                    { teks: "YA, Biji Tertutup (3a)", next: "kunci_4" },
                    { teks: "TIDAK, Biji Terbuka (3b)", next: "hasil_melinjo" } 
                ]
            },
            'kunci_4': {
                teks: "4. Apakah bijinya berkeping satu (Monokotil)?",
                pilihan: [
                    { teks: "YA, Keping Satu (4b)", next: "hasil_jagung" },
                    { teks: "TIDAK, Keping Dua (4a)", next: "hasil_mawar" }
                ]
            },
            'hasil_lumut': { teks: "TERIDENTIFIKASI: LUMUT!", isResult: true },
            'hasil_suplir': { teks: "TERIDENTIFIKASI: SUPLIR!", isResult: true },
            'hasil_jagung': { teks: "TERIDENTIFIKASI: JAGUNG!", isResult: true },
            'hasil_mawar': { teks: "TERIDENTIFIKASI: MAWAR!", isResult: true },
            'hasil_melinjo': { teks: "TERIDENTIFIKASI: MELINJO!", isResult: true }
        };
        
        function tampilkanLangkah(langkahID) {
            
            const langkah = kunci[langkahID];
            if (!langkah) {
                console.error("Error: Kunci '" + langkahID + "' tidak ditemukan.");
                tampilkanLangkah('start');
                return;
            }

            pemanduArea.innerHTML = "";
            
            if (langkah.isResult) {
                const organismeInfo = kunci.start.pilihan.find(p => p.teks === organismeAktif);
                if (organismeInfo) {
                    let imgElement = document.createElement('img');
                    imgElement.src = organismeInfo.img;
                    imgElement.className = 'img-thumbnail mb-3';
                    
                    // PERUBAHAN DI SINI: Ukuran gambar diperbesar
                    imgElement.style.maxWidth = '400px'; // Naik dari 250px ke 400px
                    imgElement.style.width = '100%'; // Responsif agar tidak overflow di HP
                    
                    imgElement.style.display = 'block';
                    imgElement.style.margin = '0 auto 1rem auto';
                    pemanduArea.appendChild(imgElement);
                }
            } else {
                let teksPertanyaan = document.createElement('h5');
                teksPertanyaan.className = 'text-gray-900 mb-3';
                teksPertanyaan.innerText = langkah.teks;
                pemanduArea.appendChild(teksPertanyaan);
            }

            let containerPilihan = document.createElement('div');
            containerPilihan.className = 'd-flex flex-wrap justify-content-center';
            pemanduArea.appendChild(containerPilihan);

            if (langkah.pilihan) {
                langkah.pilihan.forEach(pilihan => {
                    let btnPilihan = document.createElement('button');
                    if (langkah.isStart) {
                        btnPilihan.className = 'btn btn-outline-primary m-2';
                        
                        // PERUBAHAN DI SINI: Ukuran gambar thumbnail di menu awal juga diperbesar
                        btnPilihan.innerHTML = `<img src="${pilihan.img}" width="150" class="img-thumbnail"><br>${pilihan.teks}`; // Naik dari 100px ke 150px
                        
                        if (organismeSudahBenar.has(pilihan.teks)) {
                            btnPilihan.style.display = 'none';
                        }
                        
                        btnPilihan.onclick = () => { 
                            organismeAktif = pilihan.teks; 
                            tampilkanLangkah(pilihan.next); 
                        };
                    } else {
                        btnPilihan.className = 'btn btn-primary m-2';
                        btnPilihan.innerText = pilihan.teks;
                        btnPilihan.onclick = () => tampilkanLangkah(pilihan.next);
                    }
                    containerPilihan.appendChild(btnPilihan);
                });
            }

            if (langkah.isResult) {
                let hasilYgDiharapkan = 'hasil_' + organismeAktif.toLowerCase();
                let teksFeedback = document.createElement('h5');
                teksFeedback.className = 'text-center mb-3 w-100';

                if (langkahID === hasilYgDiharapkan) {
                    teksFeedback.classList.add('text-success');
                    teksFeedback.innerText = 'BENAR! ' + langkah.teks;
                    organismeSudahBenar.add(organismeAktif);
                } else {
                    teksFeedback.classList.add('text-danger');
                    let namaHasilSalah = langkah.teks.replace("TERIDENTIFIKASI: ", "").replace("!", "");
                    teksFeedback.innerText = `Oops! Pilihanmu membawamu ke ${namaHasilSalah}. Padahal kamu sedang mencari ${organismeAktif}. Coba lagi dari awal.`;
                }
                pemanduArea.insertBefore(teksFeedback, containerPilihan); 

                let btnKembali = document.createElement('button');
                btnKembali.innerText = "Identifikasi Lagi";
                btnKembali.className = 'btn btn-info m-2';
                btnKembali.onclick = () => { 
                    organismeAktif = null; 
                    tampilkanLangkah('start'); 
                };
                containerPilihan.appendChild(btnKembali);

                if (organismeSudahBenar.size >= totalOrganisme && btnKeSlide4) {
                     btnKeSlide4.style.display = 'inline-block';
                }
            }
        }
        
        tampilkanLangkah('start');

    }); // Akhir dari DOMContentLoaded
    </script>
{% endblock %}