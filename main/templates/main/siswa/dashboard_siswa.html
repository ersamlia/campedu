{% extends 'main/base.html' %}
{% load static %}
{% block title %}Dashboard Siswa{% endblock %}

{% block custom_css %}
<style>
    /* === GLOBAL === */
    body {
        font-family: 'Nunito', sans-serif;
        background: linear-gradient(135deg, #eef2f7 0%, #f7fafc 100%);
        color: #444;
    }

    .container-fluid {
        padding-top: 1.5rem;
        padding-bottom: 2rem;
    }

    /* === HERO SECTION === */
    .hero-welcome {
        background: radial-gradient(circle at top left, #6bbf8f 0%, #4b7f63 40%, #345348 100%);
        color: #fff;
        border-radius: 1.5rem;
        padding: 2rem 2.25rem;
        margin-bottom: 2rem;
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.18);
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
    }

    .hero-welcome::before {
        content: "";
        position: absolute;
        width: 220px;
        height: 220px;
        background: rgba(255, 255, 255, 0.12);
        border-radius: 50%;
        top: -60px;
        right: -40px;
        filter: blur(3px);
    }

    .hero-text {
        z-index: 1;
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
    }

    .hero-text h1 {
        font-weight: 800;
        font-size: 1.9rem;
        margin-bottom: 0.25rem;
    }

    .hero-text p {
        font-size: 1.05rem;
        margin-bottom: 0;
        font-weight: 600;
        opacity: 0.92;
    }

    .hero-icon {
        font-size: 3rem;
        background: rgba(255, 255, 255, 0.18);
        padding: 14px;
        border-radius: 1.4rem;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        z-index: 1;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
    }

    /* === STAT CARDS === */
    .stat-card {
        background: rgba(255, 255, 255, 0.96);
        border-radius: 1.1rem;
        padding: 1.25rem 1.35rem;
        border: 1px solid rgba(226, 232, 240, 0.9);
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 14px 32px rgba(15, 23, 42, 0.18);
        border-color: #cbd5f5;
    }

    .stat-content {
        flex: 1;
    }

    .stat-label {
        font-size: 0.8rem;
        color: #94a3b8;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.25rem;
        letter-spacing: 0.06em;
    }

    .stat-value {
        font-size: 1.35rem;
        font-weight: 800;
        color: #1e293b;
    }

    .stat-icon-box {
        width: 52px;
        height: 52px;
        border-radius: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.22);
        color: #ffffff;
    }

    .card-step .stat-icon-box {
        background: linear-gradient(135deg, #facc15 0%, #f97316 100%);
    }

    .card-progress .stat-icon-box {
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    }

    .card-score .stat-icon-box {
        background: linear-gradient(135deg, #f97373 0%, #fb7185 100%);
    }

    /* === TUJUAN PEMBELAJARAN === */
    .objective-box {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 1.2rem;
        padding: 1.6rem 1.9rem;
        box-shadow: 0 10px 26px rgba(15, 23, 42, 0.08);
        margin-bottom: 1.75rem;
        border-left: 5px solid #4f46e5;
    }

    .objective-title {
        font-weight: 800;
        color: #4f46e5;
        font-size: 1.1rem;
        margin-bottom: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .objective-title i {
        font-size: 1.1rem;
    }

    .objective-list {
        padding-left: 1.1rem;
        color: #4b5563;
        margin-bottom: 0;
        font-size: 0.9rem;
    }

    .objective-list li {
        margin-bottom: 0.4rem;
    }

    /* === ALUR BELAJAR / TIMELINE === */
    .timeline-container {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 1.3rem;
        padding: 1.8rem 1.8rem 1.6rem;
        box-shadow: 0 14px 30px rgba(15, 23, 42, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.9);
    }

    .timeline-header {
        font-weight: 800;
        color: #4f46e5;
        font-size: 1.15rem;
        margin-bottom: 1.35rem;
        padding-bottom: 0.8rem;
        border-bottom: 1px dashed #e5e7eb;
        display: flex;
        align-items: center;
        gap: 0.6rem;
    }

    .timeline-header i {
        color: #6366f1;
    }

    .learning-item {
        display: flex;
        align-items: center;
        padding: 0.95rem 1.15rem;
        margin-bottom: 0.8rem;
        border-radius: 1rem;
        background-color: #ffffff;
        border: 1px solid #e5e7eb;
        transition: all 0.18s ease;
    }

    .learning-item .flex-grow-1 {
        min-width: 0;
    }

    .learning-item .title,
    .learning-item span[style],
    .learning-item .flex-grow-1 span {
        font-size: 0.96rem;
    }

    .item-done {
        background-color: #ecfdf3;
        border-color: #bbf7d0;
        color: #166534;
    }

    .item-done .icon-status {
        color: #22c55e;
        font-size: 1.3rem;
    }

    .item-done .badge-custom {
        background: #bbf7d0;
        color: #166534;
    }

    .item-active {
        border: 1px solid #6366f1;
        background: linear-gradient(135deg, #eef2ff 0%, #ffffff 60%);
        box-shadow: 0 12px 28px rgba(79, 70, 229, 0.2);
        transform: translateY(-2px);
    }

    .item-active .title {
        font-size: 1.02rem;
        font-weight: 800;
        color: #4338ca;
    }

    .item-active .badge-status {
        font-size: 0.75rem;
        background-color: #e0e7ff;
        color: #4338ca;
        padding: 0.2rem 0.6rem;
        border-radius: 999px;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.3rem;
        display: inline-block;
        letter-spacing: 0.06em;
    }

    .item-locked {
        background-color: #f9fafb;
        color: #9ca3af;
        border-color: #e5e7eb;
    }

    .item-locked .icon-status {
        color: #d1d5db;
        font-size: 1.1rem;
    }

    /* === BUTTON & BADGE === */
    .btn-continue {
        background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        border-radius: 999px;
        padding: 0.45rem 1.4rem;
        font-weight: 700;
        font-size: 0.88rem;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        box-shadow: 0 10px 24px rgba(79, 70, 229, 0.35);
        transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
        border: none;
    }

    .btn-continue:hover {
        color: #e4f9d5;
        transform: translateY(-1px) scale(1.03);
        text-decoration: none;
        filter: brightness(1.03);
        box-shadow: 0 14px 32px rgba(79, 70, 229, 0.45);
    }

    .badge-custom {
        padding: 0.18rem 0.8rem;
        border-radius: 999px;
        font-size: 0.78rem;
        font-weight: 700;
    }

    /* === RESPONSIVE === */
    @media (max-width: 767.98px) {
        .hero-welcome {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
            padding: 1.6rem 1.3rem;
        }

        .hero-icon {
            align-self: flex-end;
            font-size: 2.6rem;
        }

        .stat-card {
            padding: 1.1rem 1.2rem;
        }

        .timeline-container {
            padding: 1.4rem 1.25rem;
        }

        .learning-item {
            flex-direction: row;
            align-items: flex-start;
        }

        .btn-continue {
            margin-top: 0.4rem;
        }
    }
</style>
{% endblock %}

{% block content %}

<div class="hero-welcome">
    <div class="hero-text">
        <h1>Halo, {{ user.first_name|default:user.username }}! üöÄ</h1>
        <p>Siap berpetualang di dunia biologi hari ini?</p>
    </div>
    <div class="hero-icon">
        <i class="fas fa-user-astronaut"></i>
    </div>
</div>

<div class="row mb-4">
    <div class="col-xl-4 col-md-6 mb-3">
        <div class="stat-card card-step">
            <div class="stat-content">
                <div class="stat-label">Langkah Saat Ini</div>
                <div class="stat-value">
                    {% if next_step %}
                        {{ next_step.nama }}
                    {% else %}
                        Selesai! üèÅ
                    {% endif %}
                </div>
            </div>
            <div class="stat-icon-box">
                <i class="fas fa-map-signs"></i>
            </div>
        </div>
    </div>

    <div class="col-xl-4 col-md-6 mb-3">
        <div class="stat-card card-progress">
            <div class="stat-content">
                <div class="stat-label">Total Progres</div>
                <div class="stat-value">{{ progress_percentage }}%</div>
            </div>
            <div class="stat-icon-box">
                <i class="fas fa-rocket"></i>
            </div>
        </div>
    </div>

    <div class="col-xl-4 col-md-6 mb-3">
        <div class="stat-card card-score">
            <div class="stat-content">
                <div class="stat-label">Skor Latihan</div>
                <div class="stat-value">{{ skor_terakhir }}</div>
            </div>
            <div class="stat-icon-box">
                <i class="fas fa-crown"></i>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="objective-box">
            <div class="objective-title">
                <i class="fas fa-bullseye mr-2"></i> Tujuan Pembelajaran
            </div>
            <div class="row">
                <div class="col-md-6">
                    <ul class="objective-list">
                        <li>Membedakan makhluk hidup dan benda tak hidup berdasarkan pengamatan.</li>
                        <li>Menganalisis karakteristik ciri-ciri kehidupan pada berbagai objek.</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="objective-list">
                        <li>Menggunakan mikroskop virtual untuk pengamatan struktur mikro.</li>
                        <li>Mengidentifikasi karakteristik unik dan contoh organisme dari 5 Kingdom.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="timeline-container">
            <div class="timeline-header">
                <i class="fas fa-list-ul mr-2"></i> Misi Belajar Kamu
            </div>

            {% for item in alur_belajar_data %}

                {% if item.status == 'selesai' %}
                <div class="learning-item item-done">
                    <div class="mr-3 icon-status">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="flex-grow-1">
                        <span style="font-weight: 700;">{{ item.nama }}</span>
                    </div>
                    <div>
                        <span class="badge-custom">Selesai</span>
                    </div>
                </div>

                {% elif item.status == 'aktif' %}
                <div class="learning-item item-active my-3">
                    <div class="mr-4 icon-status text-center">
                        <i class="fas fa-star fa-lg text-warning" style="color: #f6e05e;"></i>
                    </div>
                    <div class="flex-grow-1">
                        <span class="badge-status">Sedang Berlangsung</span>
                        <div class="title">{{ item.nama }}</div>
                    </div>
                    <div>
                        <a href="{{ item.url }}" class="btn-continue">
                            Mulai <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>

                {% else %}
                <div class="learning-item item-locked">
                    <div class="mr-3 icon-status">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="flex-grow-1">
                        {{ item.nama }}
                    </div>
                </div>
                {% endif %}

            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block custom_js %}
{% endblock %}
